<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>STEMShare</title>
    <script>
        // Check if user has seen the introduction
        (function() {
            const hasSeenIntroduction = localStorage.getItem('hasSeenIntroduction');
            if (hasSeenIntroduction !== 'true') {
                window.location.href = 'introduction.html';
            }
        })();
        
        // Function to reset introduction for testing - available immediately
        window.resetIntroduction = function() {
            localStorage.removeItem('hasSeenIntroduction');
            alert('Introduction has been reset. You will see it again on next login.');
        };
        
        // VR Experience Function - available globally
        window.launchVRExperience = function() {
            // Create VR modal
            const modal = document.createElement('div');
            modal.id = 'vrModal';
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.9)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '10000';
            modal.style.overflow = 'auto';
            modal.style.padding = '20px';
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); border-radius: 20px; width: 95%; max-width: 800px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); margin: auto; display: flex; flex-direction: column; color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div>
                            <h2 style="margin: 0; font-size: 1.8em;">ü•Ω VR Science Experience</h2>
                            <p style="margin: 5px 0 0; opacity: 0.8; font-size: 1em;">Immerse yourself in virtual reality learning</p>
                        </div>
                        <button id="closeVRModal" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.4em; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); display: flex; align-items: center; justify-content: center; font-weight: bold;">&times;</button>
                    </div>
                    
                    <div style="padding: 30px;">
                        <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0; color: #3498db;">üìã VR Setup Instructions</h3>
                            <div style="line-height: 1.6; opacity: 0.9;">
                                <p><strong>1. Hardware Requirements:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>VR Headset (Oculus Quest, HTC Vive, or compatible)</li>
                                    <li>VR-ready computer or standalone device</li>
                                    <li>Motion controllers (recommended)</li>
                                </ul>
                                
                                <p><strong>2. Software Setup:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Install VR browser (Firefox Reality, Oculus Browser)</li>
                                    <li>Enable WebXR in your browser settings</li>
                                    <li>Ensure stable internet connection</li>
                                </ul>
                                
                                <p><strong>3. Safety Guidelines:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Clear your play area of obstacles</li>
                                    <li>Take regular breaks (every 30 minutes)</li>
                                    <li>Stop if you experience discomfort</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <h3 style="margin: 0 0 20px 0; color: #2ecc71;">üé¨ Available VR Content</h3>
                            <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 25px; margin-bottom: 20px;">
                                <h4 style="margin: 0 0 15px 0; color: #f39c12;">VR Science.mp4</h4>
                                <p style="margin: 0 0 20px 0; opacity: 0.9;">Experience immersive science experiments and demonstrations in virtual reality. Explore molecular structures, conduct virtual lab experiments, and journey through the human body.</p>
                                <button id="playVRVideo" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none; border-radius: 25px; padding: 15px 30px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);">üé¨ Play VR Science Video</button>
                            </div>
                            
                            <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px dashed rgba(255,255,255,0.3);">
                                <p style="margin: 0; opacity: 0.7; font-style: italic;">More VR content coming soon! Stay tuned for additional immersive learning experiences.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('closeVRModal').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            document.getElementById('playVRVideo').addEventListener('click', function() {
                // Create video player modal
                const videoModal = document.createElement('div');
                videoModal.id = 'vrVideoModal';
                videoModal.style.position = 'fixed';
                videoModal.style.top = '0';
                videoModal.style.left = '0';
                videoModal.style.width = '100%';
                videoModal.style.height = '100%';
                videoModal.style.backgroundColor = 'rgba(0, 0, 0, 0.95)';
                videoModal.style.display = 'flex';
                videoModal.style.justifyContent = 'center';
                videoModal.style.alignItems = 'center';
                videoModal.style.zIndex = '10001';
                
                videoModal.innerHTML = `
                    <div style="position: relative; width: 90%; max-width: 800px;">
                        <button id="closeVRVideo" style="position: absolute; top: -50px; right: 0; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.4em; cursor: pointer; z-index: 10002;">&times;</button>
                        <video controls style="width: 100%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);" id="vrVideoPlayer">
                            <source src="./VR Science.mp4" type="video/mp4">
                            <source src="VR Science.mp4" type="video/mp4">
                            <source src="../VR Science.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div id="videoError" style="display: none; text-align: center; color: white; margin-top: 20px; padding: 20px; background: rgba(231, 76, 60, 0.8); border-radius: 10px;">
                            <p>‚ö†Ô∏è Video file not found. Please ensure 'VR Science.mp4' is in the same directory as this page.</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">You can also try placing the video file in the project folder and refreshing the page.</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(videoModal);
                
                // Add video error handling
                const videoPlayer = document.getElementById('vrVideoPlayer');
                const videoError = document.getElementById('videoError');
                
                videoPlayer.addEventListener('error', function() {
                    videoError.style.display = 'block';
                    console.log('Video failed to load. Please check if VR Science.mp4 exists in the project directory.');
                });
                
                videoPlayer.addEventListener('loadeddata', function() {
                    videoError.style.display = 'none';
                    console.log('VR Science video loaded successfully!');
                });
                
                document.getElementById('closeVRVideo').addEventListener('click', function() {
                    document.body.removeChild(videoModal);
                });
                
                videoModal.addEventListener('click', function(e) {
                    if (e.target === videoModal) {
                        document.body.removeChild(videoModal);
                    }
                });
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            // Add keyboard support (ESC key to close)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('vrModal')) {
                    document.body.removeChild(modal);
                }
            });
        };
    </script>
    <!-- Removed external CSS to prevent conflicts -->
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* Header */
        .student-header {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .student-title {
            display: flex;
            align-items: center;
            font-size: 1.9rem;
            font-weight: 700;
            color: #f8f9fa;
            text-shadow: 0 2px 8px rgba(138, 43, 226, 0.6);
        }
        
        .student-logo {
            margin-right: 12px;
            display: flex;
            align-items: center;
        }
        
        .student-logo img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(255,255,255,0.4));
            justify-content: center;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: #fff;
            border: none;
            padding: 10px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* New Layout Structure - Using absolute positioning */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            position: relative;
            min-height: calc(100vh - 120px);
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Left Content Area */
        .left-content {
            margin-right: 304px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            min-width: 0;
        }
        
        /* Right Sidebar */
        .right-sidebar {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 280px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Vertical Navigation */
        .vertical-nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .vertical-nav-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            padding: 16px 20px;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        
        .vertical-nav-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(4px);
        }
        
        .vertical-nav-btn.active {
            background: rgba(255,255,255,0.9);
            color: #667eea;
            transform: translateX(4px);
        }
        
        /* Main Content Area */
        .main-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
            flex: 1;
        }
        
        /* Icon Grid Navigation */
        .icon-grid-nav {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 32px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .icon-nav-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 32px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            min-height: 180px;
            justify-content: center;
        }
        
        .icon-nav-item:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .icon-nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }
        
        .icon-nav-icon {
            font-size: 6em;
            margin-bottom: 12px;
        }
        
        .icon-nav-icon img {
            width: 120px;
            height: 120px;
            object-fit: contain;
        }
        
        .icon-nav-icon.ai-assistant {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-direction: row;
        }
        
        .icon-nav-icon.ai-assistant .robot-emoji {
            font-size: 1.2em;
        }
        
        .icon-nav-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .icon-nav-description {
            font-size: 0.9em;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        /* Remove old navigation tabs */
        .nav-tabs {
            display: none;
        }
        
        /* Dashboard Grid - Updated */
        .dashboard-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        /* Sidebar - Updated */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Announcements */
        .announcements-card {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
        }
        
        .announcements-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .announcement-item {
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        /* Responsive Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .feature-card {
            border-radius: 20px;
            padding: 32px 24px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0,0,0,0.2);
        }
        
        .feature-icon {
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            padding: 20px;
            margin: 0 auto 20px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feature-icon img {
            width: 48px;
            height: 48px;
            filter: brightness(0) invert(1);
        }
        
        .feature-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .feature-description {
            opacity: 0.9;
            line-height: 1.4;
        }
        
        /* Content Sections */
        .tab-content {
            padding: 32px;
            min-height: 500px;
        }
        
        /* Profile Card */
        .profile-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .profile-img-container {
            position: relative;
        }
        
        .profile-img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .profile-img:hover {
            transform: scale(1.05);
        }
        
        .profile-img-container::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            z-index: -1;
        }
        
        .profile-details {
            flex: 1;
        }
        
        .profile-details h3 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .profile-details p {
            margin: 0 0 10px 0;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .level-badge {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 3px 10px rgba(253, 203, 110, 0.3);
        }
        
        .level-badge::before {
            content: '‚≠ê';
        }
        
        .student-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .points-display {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        

        
        .progress-container {
            width: 100%;
            background: #e0e0e0;
            border-radius: 10px;
            height: 15px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #2c3e50;
            margin-top: 8px;
            font-weight: 600;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        
        .quick-action-btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            padding: 12px 10px;
            border-radius: 12px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.2);
        }
        
        .quick-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }
        
        .quick-action-btn i {
            font-size: 1.2em;
        }
        
        /* Search Section */
        .search-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .search-controls {
            display: grid;
            grid-template-columns: 2fr auto 1fr;
            gap: 16px;
            margin-bottom: 16px;
            align-items: center;
        }
        
        .search-input, .grade-select {
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 1em;
            background: white;
        }
        
        .search-btn {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Resources List */
        .resources-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .resource-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            margin-bottom: 12px;
            background: #f9fafb;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 16px;
            }
            
            .left-content {
                margin-right: 0 !important;
            }
            
            .right-sidebar {
                position: static !important;
                width: 100% !important;
                margin-top: 20px;
            }
            
            .vertical-nav {
                flex-direction: row;
                overflow-x: auto;
                padding: 15px;
            }
            
            .vertical-nav-btn {
                min-width: 120px;
                white-space: nowrap;
            }
        }
        
        /* Force desktop layout for larger screens */
        @media (min-width: 769px) {
            .main-container {
                position: relative !important;
            }
            
            .left-content {
                margin-right: 304px !important;
            }
            
            .right-sidebar {
                position: absolute !important;
                top: 24px !important;
                right: 24px !important;
            }
        }
        

        

        

        
        @media (max-width: 768px) {
            .main-container {
                padding: 16px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 16px;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .search-controls {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .icon-grid-nav {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .icon-nav-item {
                min-height: 150px;
            }
            
            .vertical-nav {
                flex-direction: row;
                overflow-x: auto;
                padding: 12px;
            }
            
            .vertical-nav-btn {
                min-width: 100px;
                padding: 12px 16px;
                font-size: 0.85em;
            }
        }
        
        /* Modal styles */
        #qrModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            box-sizing: border-box;
        }
        #qrModal.show {
            display: flex;
        }
        #qrModal .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px 32px 32px 32px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            text-align: center;
            position: relative;
            overflow-y: auto;
            transform: scale(0.9);
            animation: modalSlideIn 0.3s ease-out forwards;
            margin: auto;
        }
        @keyframes modalSlideIn {
            to {
                transform: scale(1);
            }
        }
        #qrModal .close-modal {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.4em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        #qrModal .close-modal:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(238, 90, 36, 0.6);
        }
        #qrModal h3 {
            color: #2c3e50;
            font-size: 1.6em;
            font-weight: 700;
            margin-bottom: 16px;
            margin-top: 8px;
        }
        #qrModal p {
            color: #636e72;
            font-size: 1.1em;
            line-height: 1.5;
            margin-bottom: 24px;
        }
        #qrModal img {
            width: 180px;
            height: 180px;
            margin: 20px auto 20px auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            border-radius: 16px;
            border: 3px solid #ffffff;
            background: #ffffff;
            padding: 8px;
            display: block;
            object-fit: contain;
        }
        #qrModal .qr-instructions {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 16px;
            margin-top: 20px;
            font-weight: 600;
            font-size: 0.95em;
            line-height: 1.4;
            box-shadow: 0 4px 16px rgba(116, 185, 255, 0.3);
        }
        
        /* Mobile responsiveness for QR modal */
        @media (max-width: 768px) {
            #qrModal {
                padding: 20px 16px;
            }
            
            #qrModal .modal-content {
                padding: 32px 24px 24px 24px;
                max-width: 95%;
                max-height: 80vh;
            }
            
            #qrModal h3 {
                font-size: 1.4em;
                margin-bottom: 12px;
            }
            
            #qrModal p {
                font-size: 1em;
                margin-bottom: 16px;
            }
            
            #qrModal img {
                width: 160px;
                height: 160px;
                margin: 16px auto;
            }
            
            #qrModal .qr-instructions {
                padding: 14px 16px;
                font-size: 0.9em;
                margin-top: 16px;
            }
        }
        /* Old chatbot styles removed - now using ChatGPT iframe */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <!-- Add Google AI SDK -->
    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>
    <!-- Add Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="student-header">
        <div class="student-title">
            <div class="student-logo"><img src="logo baru.jpg" alt="STEMSHARE Logo"></div>
            <span>STEMSHARE</span>
        </div>
        <button class="logout-btn" onclick="window.location.href='index.html'">Log Out</button>
        <button class="logout-btn" onclick="resetIntroduction()" style="margin-left: 10px; background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">Reset Intro</button>
    </div>

    <!-- Progress bar will be updated by the main gamification system -->

            <!-- Main Container -->
        <div class="main-container" style="position: relative; max-width: 1400px; margin: 0 auto; padding: 24px; min-height: calc(100vh - 120px); width: 100%; box-sizing: border-box;">
            <!-- Left Content Area -->
            <div class="left-content" style="margin-right: 304px; display: flex; flex-direction: column; gap: 24px; min-width: 0;">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-img-container">
                            <!-- All three images are loaded but only one is visible based on level -->
                            <img src="Basic.png" alt="Basic Avatar" class="profile-img" id="basicAvatar" style="display: block;">
                            <img src="Premium.png" alt="Premium Avatar" class="profile-img" id="premiumAvatar" style="display: none;">
                            <img src="Majestic.png" alt="Majestic Avatar" class="profile-img" id="majesticAvatar" style="display: none;">
                        </div>
                        <div class="profile-details">
                            <h3>Darwin Danish Anak Nora</h3>
                            <p>SMK Kapit ‚Ä¢ Primary Year 2</p>
                            <div class="student-stats" style="background: rgba(255, 255, 255, 0.8); padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                                <div class="level-info">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <div class="level-badge" style="background: linear-gradient(135deg, #ffd700, #ff9500); padding: 8px 15px; border-radius: 20px; color: white; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">LEVEL BASIC</div>
                                        <div style="margin-left: 10px; font-size: 0.8em; color: #666; font-style: italic;">Upgrade your level to unlock new Avatar</div>
                                    </div>
                                    <div class="points-display" style="font-weight: 700; color: #2c3e50; font-size: 1.2em; display: flex; align-items: center;">
                                        <span style="background: linear-gradient(135deg, #ffd700, #ffa500); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">üèÜ</span>
                                        Points: <span id="pointsValue" style="color: #4CAF50; font-weight: bold; margin-left: 5px;">15</span>
                                    </div>
                                </div>
                                <div class="progress-container" style="width: 100%; background: #e0e0e0; border-radius: 10px; height: 15px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); margin-top: 10px;">
                                    <div class="progress-bar" id="progressBar" style="height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); border-radius: 10px; width: 15%; transition: width 0.5s ease-in-out;"></div>
                                </div>
                                <div class="progress-labels" style="display: flex; justify-content: space-between; font-size: 0.9em; color: #2c3e50; margin-top: 8px; font-weight: 600;">
                                    <span>Basic (0)</span>
                                    <span>Premium (50)</span>
                                    <span>Majestic (100)</span>
                                </div>
                            </div>
                            
                            <script>
                                // Wait for DOM to be fully loaded
                                window.onload = function() {
                                    // Initialize progress data if not exists
                                    initializeProgressData();
                                    
                                    // Get current points from localStorage or start at 0
                                    let currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
                                    const pointsValue = document.getElementById('pointsValue');
                                    const progressBar = document.getElementById('progressBar');
                                    const profileAvatar = document.getElementById('profileAvatar');
                                    const levelBadge = document.querySelector('.level-badge');
                                    
                                    // Update points display
                                    if (pointsValue) pointsValue.textContent = currentPoints;
                                    
                                    // Update progress bar (max 100 points)
                                    const progressPercentage = (currentPoints / 100) * 100;
                                    if (progressBar) progressBar.style.width = progressPercentage + '%';
                                    
                                    // Function to update avatar and level based on points
                                    function updateAvatarAndLevel() {
                                        if (currentPoints >= 100) {
                                            if (profileAvatar) profileAvatar.src = 'Majestic.png';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL MAJESTIC';
                                                levelBadge.style.background = 'linear-gradient(135deg, #9c27b0, #673ab7)';
                                            }
                                        } else if (currentPoints >= 50) {
                                            if (profileAvatar) profileAvatar.src = 'Premium.png';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL PREMIUM';
                                                levelBadge.style.background = 'linear-gradient(135deg, #2196F3, #03A9F4)';
                                            }
                                        } else {
                                            if (profileAvatar) profileAvatar.src = 'Basic.png';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL BASIC';
                                                levelBadge.style.background = 'linear-gradient(135deg, #ffd700, #ff9500)';
                                            }
                                        }
                                    }
                                    
                                    // Add a visible button to add points for better user interaction
                                    const addPointsButton = document.createElement('button');
                                    addPointsButton.textContent = '+10';
                                    addPointsButton.style.padding = '4px 8px';
                                    addPointsButton.style.background = 'linear-gradient(135deg, #4CAF50, #8BC34A)';
                                    addPointsButton.style.color = 'white';
                                    addPointsButton.style.border = 'none';
                                    addPointsButton.style.borderRadius = '12px';
                                    addPointsButton.style.cursor = 'pointer';
                                    addPointsButton.style.marginTop = '8px';
                                    addPointsButton.style.fontSize = '0.75em';
                                    addPointsButton.style.width = 'auto';
                                    addPointsButton.style.minWidth = 'auto';
                                    
                                            // Global function to add points from playing games
            window.addGamePoints = function() {
                // Add 10 points when a game is played
                currentPoints += 10;
                
                // Save to localStorage
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                // Update points display
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                // Update progress bar
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                                                    // Update avatar based on new points
                                    updateAvatarBasedOnPoints();
                                    
                                    // Track game plays
                                    let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
                                    gamesPlayed += 1;
                                    localStorage.setItem('gamesPlayed', gamesPlayed.toString());
                                    
                                    // Update the main gamification system variables
                                    if (typeof points !== 'undefined') {
                                        points = currentPoints;
                                    }
                                    if (typeof level !== 'undefined') {
                                        // Check for level progression
                                        if (currentPoints >= 100) {
                                            level = "MAJESTIC";
                                            localStorage.setItem('studentLevel', level);
                                        } else if (currentPoints >= 50) {
                                            level = "PREMIUM";
                                            localStorage.setItem('studentLevel', level);
                                        } else {
                                            level = "BASIC";
                                            localStorage.setItem('studentLevel', level);
                                        }
                                    }
                                    
                                    // Update progress data immediately
                                    updateProgressData();
                                    
                                    // Show a small notification
                                    alert('You earned 10 points for playing a game!');
                
                return true; // Allow the link to continue
            };

            // Function to add points for exploring resources
            window.addResourcePoints = function() {
                currentPoints += 5;
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                updateAvatarBasedOnPoints();
                
                const resourcesExplored = parseInt(localStorage.getItem('resourcesExplored')) || 0;
                localStorage.setItem('resourcesExplored', (resourcesExplored + 1).toString());
                
                // Update progress data immediately
                updateProgressData();
            };

            // Function to add points for sharing content
            window.addSharePoints = function() {
                currentPoints += 15;
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                updateAvatarBasedOnPoints();
                
                const contentShared = parseInt(localStorage.getItem('contentShared')) || 0;
                localStorage.setItem('contentShared', (contentShared + 1).toString());
                
                // Update progress data immediately
                updateProgressData();
            };

            // Function to add points for giving feedback
            window.addFeedbackPoints = function() {
                currentPoints += 3;
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                updateAvatarBasedOnPoints();
                
                const feedbackGiven = parseInt(localStorage.getItem('feedbackGiven')) || 0;
                localStorage.setItem('feedbackGiven', (feedbackGiven + 1).toString());
                
                // Update progress data immediately
                updateProgressData();
            };

            // Function to add points for rating resources
            window.addRatingPoints = function() {
                currentPoints += 2;
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                updateAvatarBasedOnPoints();
                
                const ratingsGiven = parseInt(localStorage.getItem('ratingsGiven')) || 0;
                localStorage.setItem('ratingsGiven', (ratingsGiven + 1).toString());
                
                // Update progress data immediately
                updateProgressData();
            };

            // Function to add points for sharing resources
            window.addShareResourcePoints = function() {
                currentPoints += 5;
                localStorage.setItem('studentPoints', currentPoints.toString());
                
                if (pointsValue) pointsValue.textContent = currentPoints;
                
                const progressPercentage = (currentPoints / 100) * 100;
                if (progressBar) progressBar.style.width = progressPercentage + '%';
                
                updateAvatarBasedOnPoints();
                
                const sharesGiven = parseInt(localStorage.getItem('sharesGiven')) || 0;
                localStorage.setItem('sharesGiven', (sharesGiven + 1).toString());
                
                // Update progress data immediately
                updateProgressData();
            };

            // Function to update progress data
            function updateProgressData() {
                const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
                const gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
                const resourcesExplored = parseInt(localStorage.getItem('resourcesExplored')) || 0;
                const contentShared = parseInt(localStorage.getItem('contentShared')) || 0;
                const feedbackGiven = parseInt(localStorage.getItem('feedbackGiven')) || 0;
                const ratingsGiven = parseInt(localStorage.getItem('ratingsGiven')) || 0;
                const sharesGiven = parseInt(localStorage.getItem('sharesGiven')) || 0;

                // Update displays
                const currentLevelDisplay = document.getElementById('currentLevelDisplay');
                const totalPointsDisplay = document.getElementById('totalPointsDisplay');
                const nextMilestoneDisplay = document.getElementById('nextMilestoneDisplay');
                const progressBarFill = document.getElementById('progressBarFill');
                const gamesPlayedCount = document.getElementById('gamesPlayedCount');
                const resourcesExploredCount = document.getElementById('resourcesExploredCount');
                const contentSharedCount = document.getElementById('contentSharedCount');
                const feedbackGivenCount = document.getElementById('feedbackGivenCount');
                const ratingsGivenCount = document.getElementById('ratingsGivenCount');
                const sharesGivenCount = document.getElementById('sharesGivenCount');

                // Update level and milestone
                let currentLevel = 'BASIC';
                let nextMilestone = '50 Points';
                let progressPercentage = (currentPoints / 50) * 100;

                if (currentPoints >= 100) {
                    currentLevel = 'MAJESTIC';
                    nextMilestone = 'Maximum Level!';
                    progressPercentage = 100;
                } else if (currentPoints >= 50) {
                    currentLevel = 'PREMIUM';
                    nextMilestone = '100 Points';
                    progressPercentage = ((currentPoints - 50) / 50) * 100;
                }

                if (currentLevelDisplay) currentLevelDisplay.textContent = currentLevel;
                if (totalPointsDisplay) totalPointsDisplay.textContent = currentPoints;
                if (nextMilestoneDisplay) nextMilestoneDisplay.textContent = nextMilestone;
                if (progressBarFill) {
                    progressBarFill.style.width = progressPercentage + '%';
                    progressBarFill.innerHTML = `<div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: white; font-weight: bold; font-size: 0.9em;">${currentPoints}/${currentPoints >= 50 ? '100' : '50'}</div>`;
                }

                // Update activity counts
                if (gamesPlayedCount) gamesPlayedCount.textContent = gamesPlayed;
                if (resourcesExploredCount) resourcesExploredCount.textContent = resourcesExplored;
                if (contentSharedCount) contentSharedCount.textContent = contentShared;
                if (feedbackGivenCount) feedbackGivenCount.textContent = feedbackGiven;
                if (ratingsGivenCount) ratingsGivenCount.textContent = ratingsGiven;
                if (sharesGivenCount) sharesGivenCount.textContent = sharesGiven;

                // Update achievement badges
                updateAchievementBadges();
                
                // Also update the main progress bar in the header
                const mainProgressBar = document.getElementById('progressBar');
                const mainPointsValue = document.getElementById('pointsValue');
                if (mainProgressBar) {
                    const mainProgressPercentage = (currentPoints / 100) * 100;
                    mainProgressBar.style.width = mainProgressPercentage + '%';
                }
                if (mainPointsValue) mainPointsValue.textContent = currentPoints;
                
                console.log('Progress data updated:', {
                    points: currentPoints,
                    level: currentLevel,
                    gamesPlayed,
                    resourcesExplored,
                    contentShared,
                    feedbackGiven,
                    ratingsGiven,
                    sharesGiven
                });
            }

            // Function to initialize progress data with sample data for testing
            function initializeProgressData() {
                // Only initialize if no data exists
                if (!localStorage.getItem('studentPoints')) {
                    // Set initial points
                    localStorage.setItem('studentPoints', '25');
                    
                    // Set sample activity data
                    localStorage.setItem('gamesPlayed', '3');
                    localStorage.setItem('resourcesExplored', '7');
                    localStorage.setItem('contentShared', '2');
                    localStorage.setItem('feedbackGiven', '4');
                    localStorage.setItem('ratingsGiven', '6');
                    localStorage.setItem('sharesGiven', '3');
                    
                    console.log('Progress data initialized with sample data');
                }
            }
            
            // Function to update achievement badges
            function updateAchievementBadges() {
                const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
                const gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
                const resourcesExplored = parseInt(localStorage.getItem('resourcesExplored')) || 0;
                const contentShared = parseInt(localStorage.getItem('contentShared')) || 0;
                const feedbackGiven = parseInt(localStorage.getItem('feedbackGiven')) || 0;
                const ratingsGiven = parseInt(localStorage.getItem('ratingsGiven')) || 0;
                const sharesGiven = parseInt(localStorage.getItem('sharesGiven')) || 0;

                const achievementBadges = document.getElementById('achievementBadges');
                if (!achievementBadges) return;

                const badges = [
                    { id: 'first-login', icon: 'üéâ', title: 'First Login', description: 'Welcome to STEMShare!', earned: true },
                    { id: 'basic-level', icon: '‚≠ê', title: 'Basic Level', description: 'Reached Basic level', earned: currentPoints >= 10 },
                    { id: 'premium-level', icon: 'üåü', title: 'Premium Level', description: 'Reached Premium level', earned: currentPoints >= 50 },
                    { id: 'majestic-level', icon: 'üëë', title: 'Majestic Level', description: 'Reached Majestic level', earned: currentPoints >= 100 },
                    { id: 'first-game', icon: 'üéÆ', title: 'First Game', description: 'Played your first game', earned: gamesPlayed >= 1 },
                    { id: 'game-master', icon: 'üèÜ', title: 'Game Master', description: 'Played 10 games', earned: gamesPlayed >= 10 },
                    { id: 'explorer', icon: 'üìö', title: 'Explorer', description: 'Explored 5 resources', earned: resourcesExplored >= 5 },
                    { id: 'contributor', icon: 'üì§', title: 'Contributor', description: 'Shared content', earned: contentShared >= 1 },
                    { id: 'feedback-giver', icon: 'üí¨', title: 'Feedback Giver', description: 'Gave 5 comments', earned: feedbackGiven >= 5 },
                    { id: 'rater', icon: '‚≠ê', title: 'Rater', description: 'Rated 3 resources', earned: ratingsGiven >= 3 },
                    { id: 'sharer', icon: 'üîó', title: 'Sharer', description: 'Shared 2 resources', earned: sharesGiven >= 2 }
                ];

                let badgesHTML = '';
                badges.forEach(badge => {
                    const opacity = badge.earned ? '1' : '0.3';
                    const filter = badge.earned ? 'none' : 'grayscale(100%)';
                    badgesHTML += `
                        <div style="text-align: center; padding: 16px; background: ${badge.earned ? '#f8f9fa' : '#e9ecef'}; border-radius: 12px; opacity: ${opacity}; filter: ${filter};">
                            <div style="font-size: 2.5em; margin-bottom: 8px;">${badge.icon}</div>
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 4px;">${badge.title}</div>
                            <div style="font-size: 0.9em; color: #7f8c8d;">${badge.description}</div>
                        </div>
                    `;
                });

                achievementBadges.innerHTML = badgesHTML;
            }
                                    
                                    // Function to update avatar based on points
                                    function updateAvatarBasedOnPoints() {
                                        // Get all avatar images
                                        const basicAvatar = document.getElementById('basicAvatar');
                                        const premiumAvatar = document.getElementById('premiumAvatar');
                                        const majesticAvatar = document.getElementById('majesticAvatar');
                                        const levelBadge = document.querySelector('.level-badge');
                                        
                                        // Hide all avatars first
                                        if (basicAvatar) basicAvatar.style.display = 'none';
                                        if (premiumAvatar) premiumAvatar.style.display = 'none';
                                        if (majesticAvatar) majesticAvatar.style.display = 'none';
                                        
                                        // Show the appropriate avatar based on points
                                        if (currentPoints >= 100) {
                                            if (majesticAvatar) majesticAvatar.style.display = 'block';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL MAJESTIC';
                                                levelBadge.style.background = 'linear-gradient(135deg, #9c27b0, #673ab7)';
                                            }
                                        } else if (currentPoints >= 50) {
                                            if (premiumAvatar) premiumAvatar.style.display = 'block';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL PREMIUM';
                                                levelBadge.style.background = 'linear-gradient(135deg, #2196F3, #03A9F4)';
                                            }
                                        } else {
                                            if (basicAvatar) basicAvatar.style.display = 'block';
                                            if (levelBadge) {
                                                levelBadge.textContent = 'LEVEL BASIC';
                                                levelBadge.style.background = 'linear-gradient(135deg, #ffd700, #ff9500)';
                                            }
                                        }
                                    }
                                    addPointsButton.style.fontWeight = 'bold';
                                    addPointsButton.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
                                    addPointsButton.style.fontSize = '0.75em';
                                    addPointsButton.style.padding = '4px 8px';
                                    addPointsButton.style.width = 'auto';
                                    addPointsButton.style.minWidth = '40px';
                                    addPointsButton.style.maxWidth = '50px';
                                    addPointsButton.style.display = 'inline-block';
                                    
                                    // Also update the +10 Points button to use the same avatar update function
                                    addPointsButton.addEventListener('click', function() {
                                        currentPoints += 10;
                                        if (pointsValue) pointsValue.textContent = currentPoints;
                                        
                                        // Update progress bar
                                        const progressPercentage = (currentPoints / 100) * 100;
                                        if (progressBar) progressBar.style.width = progressPercentage + '%';
                                        
                                        // Use the same function to update avatar
                                        updateAvatarBasedOnPoints();
                                    });
                                    
                                    // Insert button after progress labels
                                    const progressLabels = document.querySelector('.progress-labels');
                                    if (progressLabels) progressLabels.parentNode.insertBefore(addPointsButton, progressLabels.nextSibling);
                                    
                                    // Initialize avatar and level
                                    updateAvatarAndLevel();
                                };
                            </script>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                    <!-- Main Content -->
                    <div class="main-content">
                        <!-- Icon Grid Navigation -->
                        <div class="icon-grid-nav">
                            <a href="#" class="icon-nav-item active" id="resourcesIcon">
                                <div class="icon-nav-icon">üìöüé•</div>
                                <div class="icon-nav-title">Resources</div>
                                <div class="icon-nav-description">Access educational materials, notes, and study resources</div>
                            </a>
                            <a href="#" class="icon-nav-item" id="gamesIcon">
                                <div class="icon-nav-icon">üéÆ</div>
                                <div class="icon-nav-title">Games</div>
                                <div class="icon-nav-description">Play educational games and earn points</div>
                            </a>
                            <a href="#" class="icon-nav-item" id="chatbotIcon">
                                <div class="icon-nav-icon ai-assistant">
                                    <img src="logo baru.jpg" alt="AI Assistant">
                                    <span class="robot-emoji">ü§ñ</span>
                                </div>
                                <div class="icon-nav-title">AI Assistant</div>
                                <div class="icon-nav-description">Get help with your studies from our AI tutor</div>
                            </a>
                            <a href="#" class="icon-nav-item" id="arvrIcon">
                                <div class="icon-nav-icon">ü•Ω</div>
                                <div class="icon-nav-title">AR/VR</div>
                                <div class="icon-nav-description">Experience immersive learning with AR and VR</div>
                            </a>
                        </div>

                    <!-- Profile Content -->
                    <div id="profileContent" class="tab-content" style="display: none;">
                        <h2 style="color: #2c3e50; margin-top: 0;">Student Profile</h2>
                        <div style="display: flex; gap: 30px; margin-bottom: 30px;">
                            <div style="flex: 1;">
                                <h3 style="color: #3498db; margin-top: 0;">Personal Information</h3>
                                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 20px;">
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Full Name:</div>
                                        <div>Darwin Danish Anak Nora</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Student ID:</div>
                                        <div>STU-2024-001</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">School:</div>
                                        <div>SMK Kapit</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Grade Level:</div>
                                        <div>Primary Year 2</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Email:</div>
                                        <div>darwin.nora@student.stemshare.edu</div>
                                    </div>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: #3498db; margin-top: 0;">Progress Overview</h3>
                                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 20px;">
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Current Level:</div>
                                        <div id="profileLevel">BASIC</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Total Points:</div>
                                        <div id="profilePoints">0</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Resources Uploaded:</div>
                                        <div id="profileResources">0</div>
                                    </div>
                                    <div style="display: flex; margin-bottom: 15px;">
                                        <div style="font-weight: bold; width: 150px; color: #2c3e50;">Games Played:</div>
                                        <div id="profileGames">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <h3 style="color: #3498db;">Achievements</h3>
                        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 20px;">
                            <div id="achievementsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 2em; margin-bottom: 10px;">üìò</div>
                                    <div style="font-weight: bold; color: #2c3e50;">First Login</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">Completed initial setup</div>
                                </div>
                                <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                    <div style="font-size: 2em; margin-bottom: 10px;">‚≠ê</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Level 1</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">Reached Basic level</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Resources Content -->
                    <div id="resourcesContent" class="tab-content">
                        <div class="search-section">
                            <div class="search-controls">
                                <input type="text" class="search-input" placeholder="üîç Search resources..." id="noteSearch">
                                <button class="search-btn">Search</button>
                                <select class="grade-select" id="gradeSelect">
                                    <option selected disabled>Primary Year 2</option>
                                    <option>Primary Year 1</option>
                                    <option>Primary Year 2</option>
                                    <option>Primary Year 3</option>
                                    <option>Primary Year 4</option>
                                    <option>Primary Year 5</option>
                                </select>
                            </div>
                            <div style="color:#636e72; margin-bottom: 8px;">
                                <span id="resultsCount"></span>
                            </div>
                            <div style="background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%); color: white; padding: 12px 20px; border-radius: 12px; font-weight: 600; font-size: 0.95em;">
                                üîì To unlock more resources, upgrade to Premium Level. Play games or upload notes to increase your level!
                            </div>
                        </div>

                        <div style="margin-top: 30px;">
                            <h3 style="color: #2c3e50; margin-bottom: 15px;">Community Notes</h3>
                            <div id="communityNotesContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                                <!-- Community notes will be displayed here -->
                            </div>
                        </div>
                        <!-- Access Level Information -->
                        <div style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                            <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">üìö Resource Access Levels</h4>
                            <div style="font-size: 0.9em; opacity: 0.95;">
                                <strong>BASIC:</strong> Access to 3 resources ‚Ä¢ 
                                <strong>PREMIUM:</strong> Access to 5 resources ‚Ä¢ 
                                <strong>MAJESTIC:</strong> Unlimited access
                            </div>
                            <div style="font-size: 0.85em; opacity: 0.9; margin-top: 6px;">
                                üí° Resources are randomly available - upgrade your level by earning points!
                            </div>
                        </div>
                        
                        <div class="resources-container" id="resourcesList">
                            <!-- Resource cards will be injected here -->
                        </div>

                        <!-- Video Resources Section -->
                        <div style="margin-top: 40px;">
                            <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.4em;">üé• Video Resources</h3>
                            <p style="color: #636e72; margin-bottom: 20px; font-size: 0.95em;">Educational videos uploaded by teachers to enhance your learning experience.</p>
                            
                            <div class="resources-container" id="videoResourcesList">
                                <!-- Video resource cards will be injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Games Content -->
    <div id="gamesContent" class="tab-content" style="display:none;">
        <div style="width: 100%; height: 600px; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
            <iframe src="https://364500-ac49aa4579b84928a8a2653d8e2d50c2-5-latest.app.mgx.dev/" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
        </div>

        <!-- Upload Game Form - Level Restricted -->
        <div id="uploadGameSection" style="margin-top:32px; margin-bottom:32px; background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); border-radius:16px; padding:24px;">
            <!-- Content will be dynamically loaded based on student level -->
        </div>
        <div>
            <h3 style="margin-top:0;">üïπÔ∏è Community Games</h3>
            
            <!-- Game Access Level Information -->
            <div style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 20px; text-align: center;">
                <h4 style="margin: 0 0 8px 0; font-size: 1.1em;">üéÆ Game Access Levels</h4>
                <div style="font-size: 0.9em; opacity: 0.95;">
                    <strong>BASIC:</strong> Access to 3 games ‚Ä¢ 
                    <strong>PREMIUM:</strong> Access to 5 games ‚Ä¢ 
                    <strong>MAJESTIC:</strong> Unlimited access
                </div>
                <div style="font-size: 0.85em; opacity: 0.9; margin-top: 6px;">
                    üé≤ Games are randomly available - upgrade your level by earning points!
                </div>
            </div>
            
            <div id="gameList" class="cards-grid"></div>
        </div>
    </div>


                    <!-- AI Assistant Content -->
                    <div id="chatbotContent" class="tab-content" style="display:none;">
                        <div style="display: flex; flex-direction: column; height: 600px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.1);">
                            <!-- AI Header -->
                            <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); padding: 20px; color: white; text-align: center;">
                                <div style="font-size: 1.4em; font-weight: bold; margin-bottom: 5px;">ü§ñ AI Assistant</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">Powered by Simple AI - Your intelligent study companion</div>
                            </div>
                            
                            <!-- Simple AI Iframe -->
                            <div style="flex: 1; position: relative;">
                                <iframe 
                                    src="https://simple-ai.io/" 
                                    style="width: 100%; height: 100%; border: none;"
                                    title="Simple AI Assistant"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Content -->
                    <div id="progressContent" class="tab-content" style="display:none;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; border-radius: 20px; margin-bottom: 24px;">
                            <h2 style="margin: 0 0 16px 0; font-size: 1.8em;">üöÄ Your STEM Journey Progress</h2>
                            <p style="margin: 0; opacity: 0.9; font-size: 1.1em;">Track your learning milestones and unlock new opportunities as you grow!</p>
                        </div>

                        <!-- Progress Overview -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px;">
                            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 12px;">üìä</div>
                                <h3 style="color: #2c3e50; margin: 0 0 8px 0;">Current Level</h3>
                                <div id="currentLevelDisplay" style="font-size: 1.5em; font-weight: bold; color: #667eea;">BASIC</div>
                                <div style="color: #7f8c8d; font-size: 0.9em; margin-top: 8px;">Keep learning to advance!</div>
                            </div>
                            
                            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 12px;">‚≠ê</div>
                                <h3 style="color: #2c3e50; margin: 0 0 8px 0;">Total Points</h3>
                                <div id="totalPointsDisplay" style="font-size: 1.5em; font-weight: bold; color: #27ae60;">0</div>
                                <div style="color: #7f8c8d; font-size: 0.9em; margin-top: 8px;">Earn more through activities!</div>
                            </div>
                            
                            <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); text-align: center;">
                                <div style="font-size: 3em; margin-bottom: 12px;">üéØ</div>
                                <h3 style="color: #2c3e50; margin: 0 0 8px 0;">Next Milestone</h3>
                                <div id="nextMilestoneDisplay" style="font-size: 1.5em; font-weight: bold; color: #f39c12;">50 Points</div>
                                <div style="color: #7f8c8d; font-size: 0.9em; margin-top: 8px;">Upgrade to Premium!</div>
                            </div>
                        </div>

                        <!-- Progress Chart -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); margin-bottom: 32px;">
                            <h3 style="color: #2c3e50; margin: 0 0 20px 0;">üìà Progress to Next Level</h3>
                            <div style="background: #f8f9fa; border-radius: 12px; padding: 4px; position: relative;">
                                <div id="progressBarFill" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 24px; border-radius: 8px; width: 15%; transition: width 0.5s ease; position: relative;">
                                    <div style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: white; font-weight: bold; font-size: 0.9em;">15/100</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.9em; color: #7f8c8d;">
                                <span>Basic (0-49)</span>
                                <span>Premium (50-99)</span>
                                <span>Majestic (100+)</span>
                            </div>
                        </div>

                        <!-- Activity Breakdown -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); margin-bottom: 32px;">
                            <h3 style="color: #2c3e50; margin: 0 0 20px 0;">üéÆ Activity Breakdown</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">üéÆ</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Games Played</div>
                                    <div id="gamesPlayedCount" style="font-size: 1.5em; color: #667eea; font-weight: bold;">0</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">üìö</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Resources Explored</div>
                                    <div id="resourcesExploredCount" style="font-size: 1.5em; color: #27ae60; font-weight: bold;">0</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">üì§</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Content Shared</div>
                                    <div id="contentSharedCount" style="font-size: 1.5em; color: #f39c12; font-weight: bold;">0</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">üí¨</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Feedback Given</div>
                                    <div id="feedbackGivenCount" style="font-size: 1.5em; color: #e74c3c; font-weight: bold;">0</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">‚≠ê</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Ratings Given</div>
                                    <div id="ratingsGivenCount" style="font-size: 1.5em; color: #f39c12; font-weight: bold;">0</div>
                                </div>
                                <div style="text-align: center; padding: 16px; background: #f8f9fa; border-radius: 12px;">
                                    <div style="font-size: 2em; margin-bottom: 8px;">üîó</div>
                                    <div style="font-weight: bold; color: #2c3e50;">Shares Given</div>
                                    <div id="sharesGivenCount" style="font-size: 1.5em; color: #9b59b6; font-weight: bold;">0</div>
                                </div>
                            </div>
                        </div>

                        <!-- Achievement Badges -->
                        <div style="background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(0,0,0,0.1); margin-bottom: 32px;">
                            <h3 style="color: #2c3e50; margin: 0 0 20px 0;">üèÖ Achievement Badges</h3>
                            <div id="achievementBadges" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                                <!-- Badges will be populated here -->
                            </div>
                        </div>

                        <!-- Points Earning Guide -->
                        <div style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 16px rgba(116, 185, 255, 0.3);">
                            <h3 style="margin: 0 0 16px 0; font-size: 1.4em;">üí° How to Earn More Points</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">üéÆ Play Games</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+10 points per game</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">üìö Explore Resources</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+5 points per resource</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">üì§ Share Content</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+15 points per upload</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">üí¨ Give Feedback</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+3 points per comment</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">‚≠ê Rate Resources</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+2 points per rating</div>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">üîó Share Resources</div>
                                    <div style="font-size: 0.9em; opacity: 0.9;">+5 points per share</div>
                                </div>
                            </div>
                            
                            <!-- Testing Controls -->
                            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid rgba(255,255,255,0.3);">
                                <h4 style="margin: 0 0 16px 0; font-size: 1.2em;">üß™ Testing Controls</h4>
                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <button onclick="addTestPoints(10)" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5); border-radius: 8px; padding: 8px 16px; cursor: pointer; font-size: 0.9em;">+10 Points</button>
                                    <button onclick="addTestPoints(25)" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5); border-radius: 8px; padding: 8px 16px; cursor: pointer; font-size: 0.9em;">+25 Points</button>
                                    <button onclick="addTestPoints(50)" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5); border-radius: 8px; padding: 8px 16px; cursor: pointer; font-size: 0.9em;">+50 Points</button>
                                    <button onclick="resetProgressData()" style="background: rgba(231, 76, 60, 0.8); color: white; border: 1px solid rgba(255,255,255,0.5); border-radius: 8px; padding: 8px 16px; cursor: pointer; font-size: 0.9em;">Reset Progress</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AR/VR Content -->
                    <div id="arvrContent" class="tab-content" style="display:none;">
                        <!-- AR Section -->
                        <div style="margin-bottom: 40px;">
                            <h2 style="color: #2c3e50; font-size: 2rem; margin-bottom: 24px; text-align: center; text-shadow: 0 2px 8px rgba(255,255,255,0.3);">üîç Augmented Reality Experiences</h2>
                            <div class="cards-grid">
                                <div class="feature-card" onclick="window.location.href='ar-scanner.html'" style="background:linear-gradient(135deg,#fdcb6e 0%,#e17055 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üîç</span>
                                    </div>
                                    <div class="feature-title">Augmented Reality</div>
                                    <div class="feature-description">Explore interactive 3D models, scan objects, and enhance your learning with cutting-edge AR technology!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üöÄ Launch AR</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#00b894 0%,#00a085 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üî¨</span>
                                    </div>
                                    <div class="feature-title">3D Model Viewer</div>
                                    <div class="feature-description">Explore detailed 3D models of molecules, cells, and complex structures in augmented reality!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üî¨ View Models</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#e84393 0%,#fd79a8 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üß™</span>
                                    </div>
                                    <div class="feature-title">Chemistry Lab AR</div>
                                    <div class="feature-description">Conduct virtual chemistry experiments with AR overlays showing molecular structures and reactions!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üß™ Start Experiment</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#0984e3 0%,#74b9ff 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üåç</span>
                                    </div>
                                    <div class="feature-title">Geography Explorer</div>
                                    <div class="feature-description">Explore world maps, landmarks, and geographical features through interactive AR overlays!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üåç Explore World</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#fdcb6e 0%,#e17055 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">ü´Ä</span>
                                    </div>
                                    <div class="feature-title">Anatomy AR</div>
                                    <div class="feature-description">Study human anatomy with detailed AR overlays showing organs, bones, and body systems!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">ü´Ä Study Anatomy</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#6c5ce7 0%,#a29bfe 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">ü§ñ</span>
                                    </div>
                                    <div class="feature-title">Robotics AR</div>
                                    <div class="feature-description">Learn robotics concepts with interactive AR simulations of circuits, sensors, and mechanical systems!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">ü§ñ Build Robot</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- VR Section -->
                        <div>
                            <h2 style="color: #2c3e50; font-size: 2rem; margin-bottom: 24px; text-align: center; text-shadow: 0 2px 8px rgba(255,255,255,0.3);">ü•Ω Virtual Reality Experiences</h2>
                            <div class="cards-grid">
                                <div class="feature-card" style="background:linear-gradient(135deg,#a29bfe 0%,#6c5ce7 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">ü•Ω</span>
                                    </div>
                                    <div class="feature-title">Virtual Reality</div>
                                    <div class="feature-description">Dive into immersive virtual worlds, experience interactive simulations, and learn in completely new environments!</div>
                                    <button onclick="launchVRExperience()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">ü•Ω Launch VR</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#00b894 0%,#00a085 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üöÄ</span>
                                    </div>
                                    <div class="feature-title">Space Exploration VR</div>
                                    <div class="feature-description">Journey through the solar system and explore distant planets in immersive virtual reality!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üöÄ Explore Space</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#e84393 0%,#fd79a8 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üß¨</span>
                                    </div>
                                    <div class="feature-title">DNA Structure VR</div>
                                    <div class="feature-description">Navigate through the double helix structure and understand genetic concepts in 3D virtual reality!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üß¨ Explore DNA</button>
                                </div>
                                
                                <div class="feature-card" style="background:linear-gradient(135deg,#0984e3 0%,#74b9ff 100%);">
                                    <div class="feature-icon">
                                        <span style="font-size: 48px; color: white;">üî¨</span>
                                    </div>
                                    <div class="feature-title">Microscopic World VR</div>
                                    <div class="feature-description">Explore the microscopic world of cells, bacteria, and microorganisms in immersive VR!</div>
                                    <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 24px; font-weight:700; margin-top:16px; cursor: pointer;">üî¨ Explore Micro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Right Sidebar -->
            <div class="right-sidebar" style="position: absolute; top: 24px; right: 24px; width: 280px; display: flex; flex-direction: column; gap: 20px;">
                <!-- Vertical Navigation -->
                <div class="vertical-nav">
                    <a href="#" class="vertical-nav-btn active" id="profileNavBtn" onclick="showProfileContent(event)">
                        <span>üë§</span>
                        <span>Profile</span>
                    </a>
                    <a href="performance.html" class="vertical-nav-btn">
                        <span>üìä</span>
                        <span>Performance</span>
                    </a>
                    <a href="#" class="vertical-nav-btn" id="rewardsNavBtn" onclick="showRewardsModal(event)">
                        <span>üèÜ</span>
                        <span>Rewards</span>
                    </a>
                    <a href="#" class="vertical-nav-btn" id="progressNavBtn" onclick="showProgressContent(event)">
                        <span>üìà</span>
                        <span>Progress</span>
                    </a>
                    <a href="index.html" class="vertical-nav-btn">
                        <span>üè†</span>
                        <span>Home</span>
                    </a>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Announcements -->
                    <div class="announcements-card">
                        <div class="announcements-title">üì¢ Announcements</div>
                        <div class="announcement-item">
                            <strong>üéâ Congratulations!</strong><br>
                            Muhammad Ali from Malaysia achieved Premium User status
                        </div>
                        <div class="announcement-item">
                            <strong>üéâ Congratulations!</strong><br>
                            John Doe from Englandhas achieved Majestic User status.
                        </div>
                        <div class="announcement-item">
                            <strong>üéâ Congratulations!</strong><br>
                            Ahmad Abu from Indonesiahas redeem 25 points for a stationary  
                        </div>
                    </div>

                    <!-- Upload Section -->
                    <div style="background:linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); border-radius:20px; padding:24px; color:white; text-align:center;">
                        <h3 style="margin:0 0 12px 0;">‚ú® Transform Notes to Infographic</h3>
                        <p style="margin:0 0 16px 0; opacity:0.9; font-size:0.95em;">Convert your notes into engaging visual infographics with AI.</p>
                        <button id="sidebarTransformBtn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 20px; font-weight:700; cursor: pointer; width: 100%;">‚ú® Transform Now</button>
                    </div>
                    
                    <div style="background:linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius:20px; padding:24px; color:white; text-align:center; margin-top: 20px;">
                        <h3 style="margin:0 0 12px 0;">üìÑ Upload Notes</h3>
                        <p style="margin:0 0 16px 0; opacity:0.9; font-size:0.95em;">Share your knowledge with the community and earn points.</p>
                        <button id="sidebarUploadBtn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius:25px; padding:12px 20px; font-weight:700; cursor: pointer; width: 100%;">üì§ Upload Now</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Hidden file input for note upload -->
        <input type="file" id="noteFileInput" style="display: none;" accept=".txt,.doc,.docx">

        <!-- Resource Bookflip Modal -->
        <div id="resourceModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.35); z-index:9999; align-items:center; justify-content:center;">
            <div class="modal-content" style="background:#fff; border-radius:24px; box-shadow:0 8px 32px #0003; padding:32px 24px; max-width:600px; width:95%; text-align:center; position:relative;">
                <button id="closeResourceBtn" class="close-modal" style="position:absolute; top:18px; right:18px;">&times;</button>
                <div id="bookflipViewer" style="margin-bottom:18px;">
                    <!-- Bookflip pages will be injected here -->
                </div>
                <div id="resourceRating" style="margin-bottom:12px; font-size:1.1em;"></div>
                <div id="resourceComments" style="text-align:left;">
                    <b>Comments</b>
                    <div id="commentsList" style="margin-top:8px; max-height:80px; overflow-y:auto; font-size:0.97em;"></div>
                    <input id="commentInput" type="text" placeholder="Add a comment..." style="width:80%; padding:6px 10px; border-radius:8px; border:1px solid #ccc; margin-top:8px;">
                    <button id="addCommentBtn" style="background:#3ec6ff; color:#fff; border:none; border-radius:8px; padding:6px 18px; font-weight:bold; font-size:1em; margin-left:8px;">Post</button>
                </div>
            </div>
        </div>

        <!-- QR Code Modal -->
        <div id="qrModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0, 0, 0, 0.7); z-index: 9999; align-items: center; justify-content: center; padding: 40px 20px; box-sizing: border-box;">
            <div class="modal-content" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 40px 32px 32px 32px; max-width: 500px; width: 90%; max-height: 85vh; text-align: center; position: relative; overflow-y: auto; transform: scale(0.9); animation: modalSlideIn 0.3s ease-out forwards; margin: auto;">
                <button class="close-modal" style="position:absolute; top:16px; right:16px; background:linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: #fff; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.4em; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4); display: flex; align-items: center; justify-content: center; font-weight: bold;">&times;</button>
                <h3 style="color: #2c3e50; font-size: 1.6em; font-weight: 700; margin-bottom: 16px; margin-top: 8px;">Scan to Access AR Experience</h3>
                <p style="color: #636e72; font-size: 1.1em; line-height: 1.5; margin-bottom: 24px;">Use your device's camera to scan the QR code below and unlock the augmented reality content.</p>
                <img src="https://via.placeholder.com/180x180.png?text=QR+Code" alt="QR Code" style="width: 180px; height: 180px; margin: 20px auto; border-radius: 16px; border: 3px solid #ffffff; background: #ffffff; padding: 8px; display: block; object-fit: contain;">
                <div class="qr-instructions" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; padding: 16px 20px; border-radius: 16px; margin-top: 20px; font-weight: 600; font-size: 0.95em; line-height: 1.4; box-shadow: 0 4px 16px rgba(116, 185, 255, 0.3);">
                    1. Open your camera app.<br>
                    2. Point it at the QR code.<br>
                    3. Tap the notification to open the AR experience.
                </div>
            </div>
        </div>

        <script>

        // Global functions for sidebar navigation - defined at the top
        window.showProfileContent = function(event) {
            event.preventDefault();
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.vertical-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to profile button
            event.target.closest('.vertical-nav-btn').classList.add('active');
            
            // Hide all other content sections
            const resourcesContent = document.getElementById('resourcesContent');
            const gamesContent = document.getElementById('gamesContent');
            const chatbotContent = document.getElementById('chatbotContent');
            const arvrContent = document.getElementById('arvrContent');
            const profileContent = document.getElementById('profileContent');
            
            if (resourcesContent) resourcesContent.style.display = 'none';
            if (gamesContent) gamesContent.style.display = 'none';
            if (chatbotContent) chatbotContent.style.display = 'none';
            if (arvrContent) arvrContent.style.display = 'none';
            if (profileContent) profileContent.style.display = 'none';
            
            // Show profile content
            if (profileContent) profileContent.style.display = 'block';
            
            // Stop progress updates when leaving progress section
            stopProgressUpdates();
            
            // Get current points from localStorage to ensure accuracy
            const currentPointsFromStorage = parseInt(localStorage.getItem('studentPoints')) || 0;
            const currentLevelFromStorage = localStorage.getItem('studentLevel') || 'BASIC';
            
            // Update profile information
            const profileLevel = document.getElementById('profileLevel');
            const profilePoints = document.getElementById('profilePoints');
            const profileResources = document.getElementById('profileResources');
            const profileGames = document.getElementById('profileGames');
            
            if (profileLevel) profileLevel.textContent = currentLevelFromStorage;
            if (profilePoints) profilePoints.textContent = currentPointsFromStorage;
            
            // Update resources count - use actual uploads tracking
            const notesUploaded = parseInt(localStorage.getItem('notesUploaded')) || 0;
            if (profileResources) profileResources.textContent = notesUploaded;
            
            // Update games count - get actual games played from localStorage
            const gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
            if (profileGames) profileGames.textContent = gamesPlayed;
        }

        // Global function for progress content - defined at the top
        window.showProgressContent = function(event) {
            event.preventDefault();
            
            // Hide all content sections
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all navigation buttons
            document.querySelectorAll('.vertical-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to progress button
            event.target.closest('.vertical-nav-btn').classList.add('active');
            
            // Show progress content
            document.getElementById('progressContent').style.display = 'block';
            
            // Update progress data
            updateProgressData();
            
            // Set up real-time updates for progress section
            startProgressUpdates();
        };
        
        // Function to start real-time progress updates
        function startProgressUpdates() {
            // Clear any existing interval
            if (window.progressUpdateInterval) {
                clearInterval(window.progressUpdateInterval);
            }
            
            // Update progress every 2 seconds when progress section is visible
            window.progressUpdateInterval = setInterval(() => {
                const progressContent = document.getElementById('progressContent');
                if (progressContent && progressContent.style.display !== 'none') {
                    updateProgressData();
                }
            }, 2000);
        }
        
        // Function to stop progress updates
        function stopProgressUpdates() {
            if (window.progressUpdateInterval) {
                clearInterval(window.progressUpdateInterval);
                window.progressUpdateInterval = null;
            }
        }
        
        // Function to add test points
        window.addTestPoints = function(points) {
            const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
            const newPoints = currentPoints + points;
            localStorage.setItem('studentPoints', newPoints.toString());
            
            // Update progress data immediately
            updateProgressData();
            
            // Show notification
            showNotification(`+${points} points added! Total: ${newPoints}`, 'success');
        };
        
        // Function to reset progress data
        window.resetProgressData = function() {
            if (confirm('Are you sure you want to reset all progress data? This cannot be undone.')) {
                // Clear all progress data
                localStorage.removeItem('studentPoints');
                localStorage.removeItem('gamesPlayed');
                localStorage.removeItem('resourcesExplored');
                localStorage.removeItem('contentShared');
                localStorage.removeItem('feedbackGiven');
                localStorage.removeItem('ratingsGiven');
                localStorage.removeItem('sharesGiven');
                localStorage.removeItem('studentLevel');
                
                // Reinitialize with sample data
                initializeProgressData();
                
                // Update progress data
                updateProgressData();
                
                showNotification('Progress data reset successfully!', 'success');
            }
        };
        
        // Function to show notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.padding = '12px 20px';
            notification.style.borderRadius = '8px';
            notification.style.color = 'white';
            notification.style.fontWeight = 'bold';
            notification.style.zIndex = '10000';
            notification.style.transition = 'all 0.3s ease';
            notification.style.transform = 'translateX(100%)';
            
            if (type === 'success') {
                notification.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
            } else if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
            } else {
                notification.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Global function for rewards modal - defined at the top
        window.showRewardsModal = function(event) {
            console.log('showRewardsModal called', event);
            if (event) {
                event.preventDefault();
                
                // Remove active class from all nav buttons
                document.querySelectorAll('.vertical-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active class to rewards button
                event.target.closest('.vertical-nav-btn').classList.add('active');
            }
            
            // Create rewards modal
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '10000';
            modal.style.padding = '20px';
            
            // Define rewards
            const rewards = [
                {
                    id: 1,
                    name: "Free Book Voucher",
                    description: "Redeem at any bookstore for a free book of your choice",
                    points: 25,
                    icon: "üìö"
                },
                {
                    id: 2,
                    name: "STEM Stationery Set",
                    description: "Complete set of pens, pencils, and notebooks",
                    points: 50,
                    icon: "‚úèÔ∏è"
                },
                {
                    id: 3,
                    name: "STEM Sticker Pack",
                    description: "Exclusive STEM-themed stickers for your devices",
                    points: 15,
                    icon: "ü§©"
                },
                {
                    id: 4,
                    name: "Premium STEM T-Shirt",
                    description: "High-quality STEM-themed t-shirt",
                    points: 75,
                    icon: "üëï"
                }
            ];
            
            // Get current points from localStorage to ensure accuracy
            const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
            
            // Generate rewards HTML
            let rewardsHTML = '';
            rewards.forEach(reward => {
                const canRedeem = currentPoints >= reward.points;
                rewardsHTML += `
                    <div style="background: ${canRedeem ? 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)' : '#f1f2f6'}; border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid #e0e0e0; position: relative;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="font-size: 2em; margin-right: 15px;">${reward.icon}</div>
                            <div>
                                <h3 style="margin: 0 0 5px 0; color: #2c3e50;">${reward.name}</h3>
                                <div style="color: #7f8c8d; font-size: 0.9em;">${reward.description}</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-weight: bold; color: #e74c3c;">
                                ${reward.points} points
                            </div>
                            ${canRedeem ?
                                `<button onclick="redeemReward(${reward.id})" style="background: linear-gradient(135deg, #27ae60 0%, #219653 100%); color: white; border: none; border-radius: 6px; padding: 8px 16px; font-weight: 600; cursor: pointer;">
                                    Redeem Now
                                </button>` :
                                `<button style="background: #95a5a6; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-weight: 600; cursor: not-allowed;" disabled>
                                    Not Enough Points
                                </button>`
                            }
                        </div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 20px; padding: 30px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #2c3e50;">üéÅ Rewards Center</h2>
                        <button onclick="closeRewardsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                    </div>
                    <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 10px; color: white; text-align: center;">
                        <div style="font-size: 1.2em; font-weight: bold;">Your Points: <span style="font-size: 1.5em;">${currentPoints}</span></div>
                    </div>
                    <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                        ${rewardsHTML}
                    </div>
                    <div style="margin-top: 20px; text-align: center; color: #7f8c8d; font-size: 0.9em;">
                        Keep earning points by playing games and uploading notes!
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.setAttribute('id', 'rewardsModal');
        }

        // Global function to close rewards modal
        window.closeRewardsModal = function() {
            const modal = document.getElementById('rewardsModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }

        // Global function to redeem rewards
        window.redeemReward = function(rewardId) {
            const rewards = [
                {
                    id: 1,
                    name: "Free Book Voucher",
                    points: 25
                },
                {
                    id: 2,
                    name: "STEM Stationery Set",
                    points: 50
                },
                {
                    id: 3,
                    name: "STEM Sticker Pack",
                    points: 15
                },
                {
                    id: 4,
                    name: "Premium STEM T-Shirt",
                    points: 75
                }
            ];
            
            const reward = rewards.find(r => r.id === rewardId);
            
            if (!reward) {
                alert('Reward not found');
                return;
            }
            
            const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
            
            if (currentPoints >= reward.points) {
                // In a real implementation, you would connect to a backend to process the reward
                alert(`Congratulations! You've redeemed: ${reward.name}\n\nPlease visit the rewards counter with this confirmation to claim your reward.`);
                
                // Deduct points from user's account
                const newPoints = currentPoints - reward.points;
                localStorage.setItem('studentPoints', newPoints.toString());
                
                // Update points display
                const pointsValue = document.getElementById('pointsValue');
                if (pointsValue) pointsValue.textContent = newPoints;
                
                // Close modal and refresh if needed
                closeRewardsModal();
            } else {
                alert('You do not have enough points to redeem this reward.');
            }
        }

        // Game list with localStorage persistence
        let games = [];
        
        // Load games from localStorage
        function loadGames() {
            try {
                const savedGames = localStorage.getItem('communityGames');
                if (savedGames) {
                    games = JSON.parse(savedGames);
                } else {
                    // Default games if none are saved
                    games = [
                        {
                            title: "Dynamic System Game",
                            url: "https://www.engineering.com/games/dynamic-systems/",
                            likes: 3,
                            shares: 1,
                            uploader: "Admin"
                        },
                        {
                            title: "Bridge Designer",
                            url: "https://www.engineering.com/games/bridge-designer/",
                            likes: 5,
                            shares: 2,
                            uploader: "Admin"
                        }
                    ];
                }
            } catch (e) {
                console.error("Error loading games from localStorage:", e);
                // Fallback to default games if there's an error
                games = [
                    {
                        title: "Dynamic System Game",
                        url: "https://www.engineering.com/games/dynamic-systems/",
                        likes: 3,
                        shares: 1,
                        uploader: "Admin"
                    },
                    {
                        title: "Bridge Designer",
                        url: "https://www.engineering.com/games/bridge-designer/",
                        likes: 5,
                        shares: 2,
                        uploader: "Admin"
                    }
                ];
            }
        }
        
        // Save games to localStorage
        function saveGames() {
            try {
                localStorage.setItem('communityGames', JSON.stringify(games));
            } catch (e) {
                console.error("Error saving games to localStorage:", e);
            }
        }

        // Render all games (combined)
        function renderAllGames(allGames) {
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = '';
            if (!allGames || !allGames.length) {
                gameList.innerHTML = '<div style="color:#888; padding:24px;">No games uploaded yet.</div>';
                return;
            }
            
            // Determine access limits based on student level
            let accessLimit;
            const currentLevel = window.studentLevel || level || 'BASIC';
            if (currentLevel === 'BASIC') {
                accessLimit = 3;
            } else if (currentLevel === 'PREMIUM') {
                accessLimit = 5;
            } else if (currentLevel === 'MAJESTIC') {
                accessLimit = allGames.length; // Unlimited
            }
            
            // Randomly shuffle games to make locking fair
            const shuffledGames = [...allGames].sort(() => Math.random() - 0.5);
            
            // Mark games as locked or unlocked based on access limit
            shuffledGames.forEach((game, index) => {
                game.isAccessLocked = index >= accessLimit;
            });
            
            // Separate local and Firebase games for proper indexing
            const localGames = [];
            const firebaseGames = [];
            
            shuffledGames.forEach((game) => {
                if (game.id) {
                    firebaseGames.push(game);
                } else {
                    localGames.push(game);
                }
            });
            
            // Render local games
            localGames.forEach((game, localIdx) => {
                const isLocked = game.isAccessLocked;
                const card = document.createElement('div');
                card.className = 'feature-card';
                card.style.background = isLocked ? 'linear-gradient(135deg,#95a5a6 0%,#7f8c8d 100%)' : 'linear-gradient(135deg,#a29bfe 0%,#6c5ce7 100%)';
                card.style.position = 'relative';
                card.style.opacity = isLocked ? '0.6' : '1';
                
                if (isLocked) {
                    const lockOverlay = document.createElement('div');
                    lockOverlay.style.position = "absolute";
                    lockOverlay.style.top = "0";
                    lockOverlay.style.left = "0";
                    lockOverlay.style.width = "100%";
                    lockOverlay.style.height = "100%";
                    lockOverlay.style.background = "rgba(255,255,255,0.9)";
                    lockOverlay.style.borderRadius = "20px";
                    lockOverlay.style.display = "flex";
                    lockOverlay.style.flexDirection = "column";
                    lockOverlay.style.alignItems = "center";
                    lockOverlay.style.justifyContent = "center";
                    lockOverlay.innerHTML = `
                        <div style="font-size:3em; color:#d35400;">üîí</div>
                        <div style="color:#d35400; font-weight:bold; margin-top:8px;">Game Locked</div>
                        <div style="color:#555; font-size:0.9em; text-align:center; margin-top:4px;">Upgrade to ${currentLevel === 'BASIC' ? 'PREMIUM' : 'MAJESTIC'} level</div>
                    `;
                    card.appendChild(lockOverlay);
                }
                
                // Determine display based on upload type
                const isFileUpload = game.uploadType === 'file';
                const gameTypeIcon = isFileUpload ? 'üìÅ' : 'üåê';
                const gameTypeText = isFileUpload ? `File: ${game.fileName || 'Unknown'}` : 'URL Game';
                const fileSizeText = isFileUpload && game.fileSize ? ` (${game.fileSize})` : '';
                
                // Create rating stars for local games
                const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                const userRating = userRatings[`local_${localIdx}`] || 0;
                
                let ratingStars = '';
                for (let i = 1; i <= 5; i++) {
                    const starColor = i <= userRating ? '#f39c12' : '#ddd';
                    ratingStars += `<span onclick="${isLocked ? '' : `rateLocalGame(${localIdx}, ${i})`}" style="color:${starColor}; font-size:1.2em; cursor:${isLocked ? 'not-allowed' : 'pointer'}; transition:color 0.2s;" onmouseover="${!isLocked ? `this.style.color='#f39c12'` : ''}" onmouseout="${!isLocked ? `this.style.color='${starColor}'` : ''}">‚òÖ</span>`;
                }
                
                card.innerHTML = `
                    <div class="feature-title" style="margin-bottom:8px;">${game.title || 'Unknown Game'}</div>
                    <div style="font-size:0.8em; color:#ddd; margin-bottom:4px;">${gameTypeIcon} ${gameTypeText}${fileSizeText} ${isLocked ? 'üîí' : ''}</div>
                    <div style="font-size:0.97em; color:#ffeaa7; margin-bottom:4px;">
                        Uploaded by: <b>${game.uploader || "Unknown"}</b>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size:0.9em; color:#ffeaa7;">Rate:</span>
                        ${ratingStars}
                        <span style="font-size:0.8em; color:#ddd;">(${game.totalRaters || 0})</span>
                    </div>
                    ${isFileUpload ? 
                        `<button onclick="${isLocked ? '' : `viewFileGame('${game.fileName || 'game'}', '${game.title || 'Game'}')`}" style="display:inline-block; margin-bottom:12px; background:linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color:#fff; border:none; border-radius:8px; padding:8px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'};">
                            ${isLocked ? 'üîí Locked' : 'üìÅ View File'}
                        </button>` :
                        `<a href="${isLocked ? '#' : (game.url || '#')}" target="${isLocked ? '_self' : '_blank'}" style="display:inline-block; margin-bottom:12px; color:#fff; text-decoration:underline; cursor:${isLocked ? 'not-allowed' : 'pointer'};" onclick="${isLocked ? 'return false;' : 'addGamePoints()'}">
                            ${isLocked ? 'üîí Locked' : 'üåê Play Game'}
                        </a>`
                    }
                    <div style="margin-bottom:12px;">
                        <button onclick="${isLocked ? '' : `likeLocalGame(${localIdx})`}" style="background:#fff; color:#6c5ce7; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'}; margin-right:8px;">üëç Like (${game.likes || 0})</button>
                        <button onclick="${isLocked ? '' : `shareLocalGame(${localIdx})`}" style="background:#fff; color:#00b894; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'}; margin-right:8px;">üîó Share</button>
                        <button onclick="${isLocked ? '' : `deleteLocalGame(${localIdx})`}" style="background:#ff6b6b; color:#fff; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'};">üóëÔ∏è Delete</button>
                    </div>
                    <div style="font-size:0.97em; color:#ffeaa7; margin-bottom:4px;">MYR ${((game.likes || 0) * 0.10).toFixed(2)} earned (dummy)</div>
                    <div style="font-size:0.9em; color:#fff;">Shares: ${game.shares || 0}</div>
                    <div style="margin-top:10px; font-size:0.95em; color:#fff; background:rgba(0,0,0,0.15); border-radius:8px; padding:8px;">
                        Contact us to redeem money at <a href="mailto:STEMSHARE@gmails.com" style="color:#ffeaa7;">STEMSHARE@gmails.com</a> or 0123456789
                    </div>
                `;
                gameList.appendChild(card);
            });
            
            // Render Firebase games
            firebaseGames.forEach((game, firebaseIdx) => {
                const isLocked = game.isAccessLocked;
                const card = document.createElement('div');
                card.className = 'feature-card';
                card.style.background = isLocked ? 'linear-gradient(135deg,#95a5a6 0%,#7f8c8d 100%)' : 'linear-gradient(135deg,#a29bfe 0%,#6c5ce7 100%)';
                card.style.position = 'relative';
                card.style.opacity = isLocked ? '0.6' : '1';
                
                if (isLocked) {
                    const lockOverlay = document.createElement('div');
                    lockOverlay.style.position = "absolute";
                    lockOverlay.style.top = "0";
                    lockOverlay.style.left = "0";
                    lockOverlay.style.width = "100%";
                    lockOverlay.style.height = "100%";
                    lockOverlay.style.background = "rgba(255,255,255,0.9)";
                    lockOverlay.style.borderRadius = "20px";
                    lockOverlay.style.display = "flex";
                    lockOverlay.style.flexDirection = "column";
                    lockOverlay.style.alignItems = "center";
                    lockOverlay.style.justifyContent = "center";
                    lockOverlay.innerHTML = `
                        <div style="font-size:3em; color:#d35400;">üîí</div>
                        <div style="color:#d35400; font-weight:bold; margin-top:8px;">Game Locked</div>
                        <div style="color:#555; font-size:0.9em; text-align:center; margin-top:4px;">Upgrade to ${currentLevel === 'BASIC' ? 'PREMIUM' : 'MAJESTIC'} level</div>
                    `;
                    card.appendChild(lockOverlay);
                }
                
                // Firebase games use different field names
                const gameTitle = game.gameName || game.title || 'Untitled Game';
                const gameUrl = game.link || game.fileUrl || game.url || '#';
                const uploader = game.teacherName || game.uploader || 'Unknown';
                
                // Create rating stars for Firebase games
                const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                const userRating = userRatings[`firebase_${firebaseIdx}`] || 0;
                
                let ratingStars = '';
                for (let i = 1; i <= 5; i++) {
                    const starColor = i <= userRating ? '#f39c12' : '#ddd';
                    ratingStars += `<span onclick="${isLocked ? '' : `rateFirebaseGame(${firebaseIdx}, ${i})`}" style="color:${starColor}; font-size:1.2em; cursor:${isLocked ? 'not-allowed' : 'pointer'}; transition:color 0.2s;" onmouseover="${!isLocked ? `this.style.color='#f39c12'` : ''}" onmouseout="${!isLocked ? `this.style.color='${starColor}'` : ''}">‚òÖ</span>`;
                }
                
                card.innerHTML = `
                    <div class="feature-title" style="margin-bottom:8px;">${gameTitle}</div>
                    <div style="font-size:0.8em; color:#ddd; margin-bottom:4px;">üî• Firebase ${isLocked ? 'üîí' : ''}</div>
                    <div style="font-size:0.97em; color:#ffeaa7; margin-bottom:4px;">
                        Uploaded by: <b>${uploader}</b>
                    </div>
                    <div style="font-size:0.85em; color:#ddd; margin-bottom:8px;">
                        Type: ${game.type || 'Game'} ‚Ä¢ Category: ${game.category || 'General'}
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <span style="font-size:0.9em; color:#ffeaa7;">Rate:</span>
                        ${ratingStars}
                        <span style="font-size:0.8em; color:#ddd;">(${game.totalRaters || 0})</span>
                    </div>
                    <a href="${isLocked ? '#' : gameUrl}" target="${isLocked ? '_self' : '_blank'}" style="display:inline-block; margin-bottom:12px; color:#fff; text-decoration:underline; cursor:${isLocked ? 'not-allowed' : 'pointer'};" onclick="${isLocked ? 'return false;' : 'addGamePoints()'}">
                        ${isLocked ? 'üîí Locked' : 'Play Game'}
                    </a>
                    <div style="margin-bottom:12px;">
                        <button onclick="${isLocked ? '' : `likeFirebaseGame(${firebaseIdx})`}" style="background:#fff; color:#6c5ce7; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'}; margin-right:8px;">üëç Like (${game.likes || 0})</button>
                        <button onclick="${isLocked ? '' : `shareFirebaseGame(${firebaseIdx})`}" style="background:#fff; color:#00b894; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'}; margin-right:8px;">üîó Share</button>
                        <button onclick="${isLocked ? '' : `deleteFirebaseGame(${firebaseIdx})`}" style="background:#ff6b6b; color:#fff; border:none; border-radius:16px; padding:6px 16px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'};">üóëÔ∏è Delete</button>
                    </div>
                    <div style="font-size:0.97em; color:#ffeaa7; margin-bottom:4px;">MYR ${((game.likes || 0) * 0.10).toFixed(2)} earned (dummy)</div>
                    <div style="font-size:0.9em; color:#fff;">Shares: ${game.shares || 0}</div>
                    <div style="margin-top:10px; font-size:0.95em; color:#fff; background:rgba(0,0,0,0.15); border-radius:8px; padding:8px;">
                        Contact us to redeem money at <a href="mailto:STEMSHARE@gmails.com" style="color:#ffeaa7;">STEMSHARE@gmails.com</a> or 0123456789
                    </div>
                `;
                gameList.appendChild(card);
            });
        }

        // Render local games only (fallback)
        function renderGames() {
            renderAllGames(games);
        }

        // Local game functions
        window.deleteLocalGame = function(idx) {
            if (confirm('Are you sure you want to delete this game?')) {
                games.splice(idx, 1);
                saveGames();
                fetchFirebaseGames(); // Refresh to show updated combined list
            }
        };

        window.likeLocalGame = function(idx) {
            games[idx].likes = (games[idx].likes || 0) + 1;
            saveGames();
            fetchFirebaseGames(); // Refresh to show updated combined list
        };

        window.shareLocalGame = function(idx) {
            games[idx].shares = (games[idx].shares || 0) + 1;
            saveGames();
            navigator.clipboard.writeText(games[idx].url);
            alert('Game link copied to clipboard!');
            
            // Award points for sharing
            if (typeof addShareResourcePoints === 'function') {
                addShareResourcePoints();
            }
            
            fetchFirebaseGames(); // Refresh to show updated combined list
        };

        // Function to rate a local game
        window.rateLocalGame = function(idx, rating) {
            const game = games[idx];
            if (!game) return;
            
            // Save user rating
            const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
            userRatings[`local_${idx}`] = rating;
            localStorage.setItem('userRatings', JSON.stringify(userRatings));
            
            // Update game rating
            if (!game.totalRaters) game.totalRaters = 0;
            if (!game.rating) game.rating = 0;
            
            game.totalRaters += 1;
            game.rating = ((game.rating * (game.totalRaters - 1)) + rating) / game.totalRaters;
            
            // Save updated game data
            saveGames();
            
            // Award points for rating
            if (typeof addRatingPoints === 'function') {
                addRatingPoints();
            }
            
            // Refresh the game list
            fetchFirebaseGames();
            
            alert(`Thank you for rating! You earned 2 points.`);
        };

        // Firebase game functions - store reference to Firebase games
        let currentFirebaseGames = [];

        window.deleteFirebaseGame = function(idx) {
            if (confirm('Are you sure you want to delete this game?')) {
                const gameToDelete = currentFirebaseGames[idx];
                if (gameToDelete && gameToDelete.id) {
                    db.ref(`games/${gameToDelete.id}`).remove()
                        .then(() => {
                            console.log("Game deleted from Firebase");
                            fetchFirebaseGames(); // Refresh the list
                        })
                        .catch(error => {
                            console.error("Error deleting game from Firebase:", error);
                            alert("Error deleting game. Please try again.");
                        });
                }
            }
        };

        window.likeFirebaseGame = function(idx) {
            const gameToUpdate = currentFirebaseGames[idx];
            if (gameToUpdate && gameToUpdate.id) {
                const currentLikes = gameToUpdate.likes || 0;
                db.ref(`games/${gameToUpdate.id}/likes`).set(currentLikes + 1)
                    .then(() => {
                        console.log("Game likes updated in Firebase");
                        fetchFirebaseGames(); // Refresh the list
                    })
                    .catch(error => {
                        console.error("Error updating likes in Firebase:", error);
                    });
            }
        };

        window.shareFirebaseGame = function(idx) {
            const gameToUpdate = currentFirebaseGames[idx];
            if (gameToUpdate && gameToUpdate.id) {
                const currentShares = gameToUpdate.shares || 0;
                const gameUrl = gameToUpdate.link || gameToUpdate.fileUrl || gameToUpdate.url || '#';
                
                // Copy URL to clipboard
                navigator.clipboard.writeText(gameUrl);
                alert('Game link copied to clipboard!');
                
                // Award points for sharing
                if (typeof addShareResourcePoints === 'function') {
                    addShareResourcePoints();
                }
                
                // Update share count in Firebase
                db.ref(`games/${gameToUpdate.id}/shares`).set(currentShares + 1)
                    .then(() => {
                        console.log("Game shares updated in Firebase");
                        alert('Game shared successfully! You earned 5 points.');
                        fetchFirebaseGames(); // Refresh the list
                    })
                    .catch(error => {
                        console.error("Error updating shares in Firebase:", error);
                    });
            }
        };

        // Function to rate a Firebase game
        window.rateFirebaseGame = function(idx, rating) {
            const gameToUpdate = currentFirebaseGames[idx];
            if (!gameToUpdate || !gameToUpdate.id) return;
            
            // Save user rating
            const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
            userRatings[`firebase_${idx}`] = rating;
            localStorage.setItem('userRatings', JSON.stringify(userRatings));
            
            // Update game rating in Firebase
            const currentRaters = gameToUpdate.totalRaters || 0;
            const currentRating = gameToUpdate.rating || 0;
            const newRaters = currentRaters + 1;
            const newRating = ((currentRating * currentRaters) + rating) / newRaters;
            
            db.ref(`games/${gameToUpdate.id}`).update({
                totalRaters: newRaters,
                rating: newRating
            })
            .then(() => {
                console.log("Game rating updated in Firebase");
                
                // Award points for rating
                if (typeof addRatingPoints === 'function') {
                    addRatingPoints();
                }
                
                alert(`Thank you for rating! You earned 2 points.`);
                fetchFirebaseGames(); // Refresh the list
            })
            .catch((error) => {
                console.error("Error updating rating in Firebase:", error);
            });
        };

        // Upload form handler
        document.addEventListener('DOMContentLoaded', function() {
            // Load games from localStorage
            loadGames();
            
            // Upload game form is now handled dynamically in updateUploadGameSection()
            renderGames();
        });


            // Icon navigation logic
            const icons = ['resourcesIcon', 'gamesIcon', 'chatbotIcon', 'arvrIcon'];
            const contents = ['resourcesContent', 'gamesContent', 'chatbotContent', 'arvrContent', 'profileContent'];

            function switchIcon(activeIconId) {
                // Remove active class from all icons
                icons.forEach(iconId => {
                    document.getElementById(iconId).classList.remove('active');
                });
                
                // Hide all content including profile content
                contents.forEach(contentId => {
                    document.getElementById(contentId).style.display = 'none';
                });
                
                // Activate selected icon
                document.getElementById(activeIconId).classList.add('active');
                
                // Show corresponding content
                const contentMap = {
                    'resourcesIcon': 'resourcesContent',
                    'gamesIcon': 'gamesContent', 
                    'chatbotIcon': 'chatbotContent',
                    'arvrIcon': 'arvrContent'
                };
                
                document.getElementById(contentMap[activeIconId]).style.display = 'block';
            }

            // Add event listeners for icon navigation
            icons.forEach(iconId => {
                document.getElementById(iconId).addEventListener('click', (e) => {
                    e.preventDefault();
                    switchIcon(iconId);
                    
                    // Fetch Firebase games when Games icon is clicked
                    if (iconId === 'gamesIcon') {
                        fetchFirebaseGames();
                    }
                });
            });

            // Firebase config (replace with your actual config)
            const firebaseConfig = {
                apiKey: "AIzaSyAJhDnZ0G9sN8UGddnIOu0hpIdhCP7xHV8",
                authDomain: "lumina-ai-7d702.firebaseapp.com",
                databaseURL: "https://lumina-ai-7d702-default-rtdb.firebaseio.com",
                projectId: "lumina-ai-7d702",
                storageBucket: "lumina-ai-7d702.appspot.com",
                messagingSenderId: "481682375832",
                appId: "1:481682375832:web:6985bef13bbe9391b23ced",
                measurementId: "G-0TESFWWV4G"
            };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();

            // Student level for demo - Change this to "PREMIUM" to unlock all resources
            const studentLevel = "BASIC"; // Options: "BASIC", "PREMIUM", "MAJESTIC"

            // Fetch resources from Firebase
            function fetchResources() {
                db.ref('notes').once('value').then(snapshot => {
                    const resources = [];
                    snapshot.forEach(child => {
                        // child.key is uniqueId, child.val() is the resource object
                        resources.push({ id: child.key, ...child.val() });
                    });
                    console.log("Fetched resources:", resources); // Debug log
                    renderResources(resources);
                }).catch(error => {
                    console.error("Error fetching resources:", error);
                    // Fallback to demo data if Firebase fails
                    renderResources(demoResources);
                });
            }

            // Fetch games from Firebase
            function fetchFirebaseGames() {
                db.ref('games').once('value').then(snapshot => {
                    const firebaseGames = [];
                    snapshot.forEach(child => {
                        const gameData = { id: child.key, ...child.val() };
                        firebaseGames.push(gameData);
                    });
                    console.log("Fetched games from Firebase:", firebaseGames);
                    
                    // Store reference to Firebase games for interaction functions
                    currentFirebaseGames = firebaseGames;
                    
                    // Merge with local games
                    const allGames = [...games, ...firebaseGames];
                    renderAllGames(allGames);
                }).catch(error => {
                    console.error("Error fetching games:", error);
                    currentFirebaseGames = [];
                    renderAllGames(games); // Fallback to local games only
                });
            }

            // Demo resources as fallback
            const demoResources = [
                {
                    id: "demo1",
                    fileName: "Introduction to Physics - Motion and Forces",
                    teacherName: "Dr. Sarah Johnson",
                    uploadedAt: "2024-01-15",
                    rating: 4.8,
                    totalRaters: 25,
                    locked: false,
                    subject: "Physics",
                    grade: "Primary Year 2",
                    fileUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf",
                    fileType: "pdf",
                    comments: [
                        { user: "Alex Chen", text: "Very helpful explanation of basic physics concepts!" },
                        { user: "Maria Santos", text: "The examples made it easy to understand." }
                    ]
                },
                {
                    id: "demo2",
                    fileName: "Mathematics: Fractions and Decimals",
                    teacherName: "Prof. Ahmad Rahman",
                    uploadedAt: "2024-01-20",
                    rating: 4.5,
                    totalRaters: 18,
                    locked: true,
                    subject: "Mathematics",
                    grade: "Primary Year 2",
                    fileUrl: "https://sample-videos.com/zip/10/mp4/mp4/SampleVideo_1280x720_1mb.mp4",
                    fileType: "video",
                    comments: [
                        { user: "Student A", text: "Great video tutorial!" },
                        { user: "Student B", text: "Helped me understand fractions better." }
                    ]
                }
            ];

            // Video resources for the new section
            const videoResources = [
                {
                    id: "video1",
                    fileName: "Photosynthesis - Understanding Plant Growth",
                    teacherName: "Ms. Emily Chen",
                    uploadedAt: "2024-01-25",
                    rating: 4.9,
                    totalRaters: 32,
                    locked: false,
                    subject: "Biology",
                    grade: "Primary Year 3",
                    fileUrl: "Photosynthesis.mp4",
                    fileType: "video",
                    likes: 45,
                    isLiked: false,
                    comments: [
                        { user: "David Kim", text: "Amazing video! The visual examples really helped me understand photosynthesis." },
                        { user: "Lisa Wong", text: "Perfect explanation of how plants make their own food!" },
                        { user: "Tommy Rodriguez", text: "The animation made it so clear. Great teaching resource!" }
                    ]
                },
                {
                    id: "video2",
                    fileName: "Algebra Basics - Solving Linear Equations",
                    teacherName: "Mr. James Wilson",
                    uploadedAt: "2024-01-28",
                    rating: 4.7,
                    totalRaters: 28,
                    locked: false,
                    subject: "Mathematics",
                    grade: "Primary Year 4",
                    fileUrl: "Algebra.mp4",
                    fileType: "video",
                    likes: 38,
                    isLiked: false,
                    comments: [
                        { user: "Sophie Anderson", text: "Finally understand algebra! The step-by-step approach is perfect." },
                        { user: "Marcus Johnson", text: "Great examples and clear explanations. Very helpful!" },
                        { user: "Emma Davis", text: "The visual representation of equations really clicked for me." }
                    ]
                }
            ];

            function renderResources(resources) {
                const resourcesList = document.getElementById('resourcesList');
                const resultsCount = document.getElementById('resultsCount');
                resourcesList.innerHTML = '';
                
                if (resources.length === 0) {
                    resourcesList.innerHTML = `<div style="color:#d35400; font-weight:bold; padding:24px; text-align:center;">No resources available. Please check back later or upload new notes.</div>`;
                    return;
                }
                
                // Determine access limits based on student level
                let accessLimit;
                const currentLevel = window.studentLevel || level || 'BASIC';
                if (currentLevel === 'BASIC') {
                    accessLimit = 3;
                } else if (currentLevel === 'PREMIUM') {
                    accessLimit = 5;
                } else if (currentLevel === 'MAJESTIC') {
                    accessLimit = resources.length; // Unlimited
                }
                
                // Randomly shuffle resources to make locking fair
                const shuffledResources = [...resources].sort(() => Math.random() - 0.5);
                
                // Mark resources as locked or unlocked based on access limit
                shuffledResources.forEach((resource, index) => {
                    resource.isAccessLocked = index >= accessLimit;
                });
                
                const unlockedCount = shuffledResources.filter(r => !r.isAccessLocked).length;
                const totalCount = resources.length;
                resultsCount.textContent = `Showing ${unlockedCount} of ${totalCount} resources`;
                
                shuffledResources.forEach(resource => {
                    const isLocked = resource.isAccessLocked;
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.style.opacity = isLocked ? '0.6' : '1';
                    card.style.position = 'relative';
                    
                    // Lock overlay for locked resources
                    if (isLocked) {
                        const lockOverlay = document.createElement('div');
                        lockOverlay.style.position = "absolute";
                        lockOverlay.style.top = "0";
                        lockOverlay.style.left = "0";
                        lockOverlay.style.width = "100%";
                        lockOverlay.style.height = "100%";
                        lockOverlay.style.background = "rgba(255,255,255,0.85)";
                        lockOverlay.style.borderRadius = "12px";
                        lockOverlay.style.display = "flex";
                        lockOverlay.style.flexDirection = "column";
                        lockOverlay.style.alignItems = "center";
                        lockOverlay.style.justifyContent = "center";
                        lockOverlay.innerHTML = `
                            <div style="font-size:2em; color:#d35400;">üîí</div>
                            <div style="color:#d35400; font-weight:bold; margin-top:6px;">Locked</div>
                            <div style="color:#555; font-size:0.97em; text-align:center;">Upgrade to ${currentLevel === 'BASIC' ? 'PREMIUM' : 'MAJESTIC'} level to access more resources.</div>
                        `;
                        card.appendChild(lockOverlay);
                    }
                    
                    card.innerHTML = `
                        <div style="font-size:2em;">${isLocked ? 'üîí' : getFileTypeIcon(resource.fileType)}</div>
                        <div style="flex:1;">
                            <div style="font-weight:bold; margin-bottom:4px;">${resource.fileName}</div>
                            <div style="font-size:0.9em; color:#666;">by ${resource.teacherName} ‚Ä¢ ${resource.uploadedAt ? new Date(resource.uploadedAt).toISOString().slice(0,10) : ''}</div>
                            <div style="color:#f39c12; font-size:0.9em;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (${resource.totalRaters || 0} reviews)</div>
                        </div>
                        <button style="background:${isLocked ? '#6c757d' : '#28a745'}; color:white; border:none; padding:8px 16px; border-radius:8px; font-weight:bold; cursor:${isLocked ? 'not-allowed' : 'pointer'};">
                            ${isLocked ? 'üîí Locked' : 'üìñ View'}
                        </button>
                    `;
                    
                    // Add click event to view button
                    const viewBtn = card.querySelector('button');
                    if (!isLocked) {
                        viewBtn.onclick = () => openResourceModal(resource);
                    } else {
                        viewBtn.onclick = () => showUpgradeModal();
                    }
                    
                    resourcesList.appendChild(card);
                });

                // After rendering main resources, also render video resources
                renderVideoResources();
            }

            function renderVideoResources() {
                const videoResourcesList = document.getElementById('videoResourcesList');
                if (!videoResourcesList) return;
                
                videoResourcesList.innerHTML = '';
                
                videoResources.forEach((resource, index) => {
                    const card = document.createElement('div');
                    card.className = 'resource-card';
                    card.style.position = 'relative';
                    card.style.flexDirection = 'column';
                    card.style.alignItems = 'stretch';
                    card.style.padding = '24px';
                    card.style.marginBottom = '24px';
                    
                    // Create video player
                    const videoPlayer = `
                        <div style="margin-bottom: 16px;">
                            <video controls style="width:100%; max-height:300px; border-radius:12px; border:2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                <source src="${resource.fileUrl}" type="video/mp4">
                                <p>Your browser doesn't support HTML5 video. <a href="${resource.fileUrl}" target="_blank">Download the video</a> instead.</p>
                            </video>
                        </div>
                    `;
                    
                    // Create resource info
                    const resourceInfo = `
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="font-size:2em; margin-right: 16px;">üé•</div>
                            <div style="flex:1;">
                                <div style="font-weight:bold; font-size:1.2em; margin-bottom:4px; color:#2c3e50;">${resource.fileName}</div>
                                <div style="font-size:0.95em; color:#666; margin-bottom:4px;">by ${resource.teacherName} ‚Ä¢ ${resource.uploadedAt ? new Date(resource.uploadedAt).toISOString().slice(0,10) : ''}</div>
                                <div style="color:#f39c12; font-size:0.95em;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (${resource.totalRaters || 0} reviews)</div>
                            </div>
                        </div>
                    `;
                    
                    // Create interactive rating section
                    const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                    const userRating = userRatings[resource.id] || 0;
                    
                    let ratingStars = '';
                    for (let i = 1; i <= 5; i++) {
                        const starColor = i <= userRating ? '#f39c12' : '#ddd';
                        ratingStars += `<span onclick="rateVideoResource('${resource.id}', ${i})" style="color:${starColor}; font-size:1.2em; cursor:pointer; transition:color 0.2s;" onmouseover="this.style.color='#f39c12'" onmouseout="this.style.color='${starColor}'">‚òÖ</span>`;
                    }
                    
                    const ratingSection = `
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding: 12px; background: #fff3cd; border-radius: 12px; border: 1px solid #ffeaa7;">
                            <span style="font-weight: bold; color: #856404;">Rate this video:</span>
                            ${ratingStars}
                            <span style="color: #856404; font-size: 0.9em;">(${resource.totalRaters || 0} reviews)</span>
                        </div>
                    `;
                    
                    // Create like, comment, and share section
                    const likeCommentSection = `
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 12px;">
                            <button id="likeBtn_${resource.id}" onclick="toggleLike('${resource.id}')" style="display: flex; align-items: center; gap: 8px; background: ${resource.isLiked ? '#e74c3c' : '#3498db'}; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                                ${resource.isLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${resource.likes} Likes
                            </button>
                            <div style="flex: 1; display: flex; gap: 8px;">
                                <input type="text" id="commentInput_${resource.id}" placeholder="Add a comment..." style="flex: 1; padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 0.9em; outline: none;" onkeypress="if(event.key==='Enter') addComment('${resource.id}')">
                                <button onclick="addComment('${resource.id}')" style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                                    üí¨ Comment
                                </button>
                            </div>
                            <button onclick="shareVideoResource('${resource.id}')" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s ease;">
                                üîó Share
                            </button>
                        </div>
                    `;
                    
                    // Create comments section
                    const commentsSection = `
                        <div style="background:#f8f9fa; border-radius:12px; padding:16px; margin-top:16px;">
                            <div style="font-weight:bold; color:#2c3e50; margin-bottom:12px; font-size:1.1em;">üí¨ Student Comments</div>
                            <div id="commentsContainer_${resource.id}">
                                ${resource.comments.map(comment => `
                                    <div style="background:white; border-radius:8px; padding:12px; margin-bottom:8px; border-left:4px solid #3498db;">
                                        <div style="font-weight:bold; color:#2c3e50; font-size:0.9em; margin-bottom:4px;">${comment.user}</div>
                                        <div style="color:#555; font-size:0.9em;">${comment.text}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    card.innerHTML = videoPlayer + resourceInfo + ratingSection + likeCommentSection + commentsSection;
                    videoResourcesList.appendChild(card);
                });
            }

            // Like functionality
            function toggleLike(videoId) {
                const video = videoResources.find(v => v.id === videoId);
                if (!video) return;
                
                video.isLiked = !video.isLiked;
                video.likes += video.isLiked ? 1 : -1;
                
                const likeBtn = document.getElementById(`likeBtn_${videoId}`);
                if (likeBtn) {
                    likeBtn.innerHTML = `${video.isLiked ? '‚ù§Ô∏è' : 'ü§ç'} ${video.likes} Likes`;
                    likeBtn.style.background = video.isLiked ? '#e74c3c' : '#3498db';
                }
                
                // Save to localStorage for persistence
                localStorage.setItem('videoLikes', JSON.stringify(videoResources));
            }

            // Comment functionality
            function addComment(videoId) {
                const commentInput = document.getElementById(`commentInput_${videoId}`);
                const commentText = commentInput.value.trim();
                
                if (!commentText) {
                    alert('Please enter a comment!');
                    return;
                }
                
                const video = videoResources.find(v => v.id === videoId);
                if (!video) return;
                
                // Generate a random student name for the comment
                const studentNames = ['Alex Chen', 'Maria Santos', 'David Kim', 'Lisa Wong', 'Tommy Rodriguez', 'Sophie Anderson', 'Marcus Johnson', 'Emma Davis', 'James Wilson', 'Sarah Johnson'];
                const randomName = studentNames[Math.floor(Math.random() * studentNames.length)];
                
                // Add new comment
                const newComment = {
                    user: randomName,
                    text: commentText
                };
                
                video.comments.push(newComment);
                
                // Update the comments container
                const commentsContainer = document.getElementById(`commentsContainer_${videoId}`);
                if (commentsContainer) {
                    const commentElement = document.createElement('div');
                    commentElement.style.cssText = 'background:white; border-radius:8px; padding:12px; margin-bottom:8px; border-left:4px solid #3498db;';
                    commentElement.innerHTML = `
                        <div style="font-weight:bold; color:#2c3e50; font-size:0.9em; margin-bottom:4px;">${newComment.user}</div>
                        <div style="color:#555; font-size:0.9em;">${newComment.text}</div>
                    `;
                    commentsContainer.appendChild(commentElement);
                }
                
                // Clear input
                commentInput.value = '';
                
                // Save to localStorage for persistence
                localStorage.setItem('videoComments', JSON.stringify(videoResources));
                
                // Award points for giving feedback
                if (typeof addFeedbackPoints === 'function') {
                    addFeedbackPoints();
                }
                
                // Show success message
                alert('Comment added successfully! You earned 3 points for giving feedback!');
            }

            // Function to rate a video resource
            window.rateVideoResource = function(videoId, rating) {
                const video = videoResources.find(v => v.id === videoId);
                if (!video) return;
                
                // Save user rating
                const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                userRatings[videoId] = rating;
                localStorage.setItem('userRatings', JSON.stringify(userRatings));
                
                // Update video rating
                if (!video.totalRaters) video.totalRaters = 0;
                if (!video.rating) video.rating = 0;
                
                video.totalRaters += 1;
                video.rating = ((video.rating * (video.totalRaters - 1)) + rating) / video.totalRaters;
                
                // Award points for rating
                if (typeof addRatingPoints === 'function') {
                    addRatingPoints();
                }
                
                // Re-render video resources to update rating display
                renderVideoResources();
                
                alert(`Thank you for rating! You earned 2 points.`);
            };

            // Function to share a video resource
            window.shareVideoResource = function(videoId) {
                const video = videoResources.find(v => v.id === videoId);
                if (!video) return;
                
                // Create shareable link
                const shareText = `Check out this amazing STEM video: ${video.fileName} on STEMShare!`;
                
                // Simulate sharing
                if (navigator.share) {
                    navigator.share({
                        title: 'STEMShare Video',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('Video link copied to clipboard!');
                    });
                }
                
                // Award points for sharing
                if (typeof addShareResourcePoints === 'function') {
                    addShareResourcePoints();
                }
                
                alert('Video shared successfully! You earned 5 points.');
            };

            // Load saved video interactions from localStorage
            function loadVideoInteractions() {
                const savedLikes = localStorage.getItem('videoLikes');
                const savedComments = localStorage.getItem('videoComments');
                
                if (savedLikes) {
                    try {
                        const savedData = JSON.parse(savedLikes);
                        // Update likes and isLiked status
                        savedData.forEach(savedVideo => {
                            const video = videoResources.find(v => v.id === savedVideo.id);
                            if (video) {
                                video.likes = savedVideo.likes;
                                video.isLiked = savedVideo.isLiked;
                            }
                        });
                    } catch (e) {
                        console.log('No saved likes data');
                    }
                }
                
                if (savedComments) {
                    try {
                        const savedData = JSON.parse(savedComments);
                        // Update comments
                        savedData.forEach(savedVideo => {
                            const video = videoResources.find(v => v.id === savedVideo.id);
                            if (video && savedVideo.comments) {
                                video.comments = savedVideo.comments;
                            }
                        });
                    } catch (e) {
                        console.log('No saved comments data');
                    }
                }
            }

            function getFileTypeIcon(fileType) {
                const icons = { "pdf": "üìÑ", "video": "üé•", "image": "üñºÔ∏è", "document": "üìù" };
                return icons[fileType] || "üìÅ";
            }

            function showUpgradeModal() {
                alert("üîí This resource is for Premium users only!\n\n‚ú® Upgrade your account by:\n‚Ä¢ Playing more games\n‚Ä¢ Uploading helpful resources\n‚Ä¢ Participating in activities\n\nKeep learning to unlock premium content!");
            }

            // Resource modal functionality
            const resourceModal = document.getElementById('resourceModal');
            const closeResourceBtn = document.getElementById('closeResourceBtn');
            const bookflipViewer = document.getElementById('bookflipViewer');
            const resourceRating = document.getElementById('resourceRating');
            const resourceComments = document.getElementById('commentsList');
            const commentInput = document.getElementById('commentInput');
            const addCommentBtn = document.getElementById('addCommentBtn');

            let currentResource = null;
            let currentPage = 0;

            function openResourceModal(resource) {
                currentResource = resource;
                currentPage = 0;
                bookflipViewer.innerHTML = '';
                
                // Display content directly from fileUrl if available
                if (resource.fileUrl) {
                    const fileType = getFileType(resource.fileUrl);
                    const contentDiv = document.createElement('div');
                    contentDiv.style.width = "100%";
                    contentDiv.style.marginBottom = "16px";
                    contentDiv.style.textAlign = "center";
                    
                    switch (fileType) {
                        case "pdf":
                            contentDiv.innerHTML = `
                                <div style="margin-bottom: 16px;">
                                    <h3 style="color: #2c3e50; margin-bottom: 8px;">${resource.fileName}</h3>
                                    <p style="color: #7f8c8d;">PDF Document</p>
                                </div>
                                <iframe src="${resource.fileUrl}" style="width:100%;height:400px;border-radius:8px;border:2px solid #e9ecef;"></iframe>
                                <p style="margin-top: 12px; font-size: 0.9em; color: #6c757d;">
                                    <a href="${resource.fileUrl}" target="_blank" style="color: #007bff; text-decoration: none;">üìñ Open in new tab</a>
                                </p>
                            `;
                            break;
                        case "image":
                            contentDiv.innerHTML = `
                                <div style="margin-bottom: 16px;">
                                    <h3 style="color: #2c3e50; margin-bottom: 8px;">${resource.fileName}</h3>
                                    <p style="color: #7f8c8d;">Educational Diagram</p>
                                </div>
                                <img src="${resource.fileUrl}" alt="Educational Content" style="max-width:100%;max-height:400px;border-radius:8px;border:2px solid #e9ecef;box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                            `;
                            break;
                        case "video":
                            contentDiv.innerHTML = `
                                <div style="margin-bottom: 16px;">
                                    <h3 style="color: #2c3e50; margin-bottom: 8px;">${resource.fileName}</h3>
                                    <p style="color: #7f8c8d;">Educational Video</p>
                                </div>
                                <video controls style="width:100%;max-height:400px;border-radius:8px;border:2px solid #e9ecef;">
                                    <source src="${resource.fileUrl}" type="video/mp4">
                                    <p>Your browser doesn't support HTML5 video. <a href="${resource.fileUrl}" target="_blank">Download the video</a> instead.</p>
                                </video>
                            `;
                            break;
                        default:
                            contentDiv.innerHTML = `
                                <div style="text-align:center;padding:40px;background:#f8f9fa;border-radius:8px;border:2px solid #e9ecef;">
                                    <div style="font-size:3em;margin-bottom:16px;">üìÑ</div>
                                    <div style="font-size:1.5em;margin-bottom:16px;color:#2c3e50;">${resource.fileName}</div>
                                    <p style="color:#6c757d;margin-bottom:24px;">This educational resource contains valuable content for your studies.</p>
                                    <a href="${resource.fileUrl}" target="_blank" style="display:inline-block;background:linear-gradient(135deg, #007bff 0%, #0056b3 100%);color:white;padding:12px 24px;border-radius:8px;text-decoration:none;font-weight:bold;">
                                        üìñ Open Resource
                                    </a>
                                </div>
                            `;
                    }
                    
                    bookflipViewer.appendChild(contentDiv);
                } else if (resource.pages && resource.pages.length > 0) {
                    // Fallback to bookflip view if no fileUrl
                    renderBookflip();
                } else {
                    // Fallback content
                    bookflipViewer.innerHTML = `
                        <div style="text-align:center;padding:40px;background:#f8f9fa;border-radius:8px;">
                            <div style="font-size:3em;margin-bottom:16px;">üìö</div>
                            <div style="font-size:1.5em;margin-bottom:16px;">${resource.fileName}</div>
                            <p style="color:#6c757d;">This resource contains valuable educational content.</p>
                        </div>
                    `;
                }
                
                renderRating();
                renderComments();
                resourceModal.style.display = 'flex';
                
                // Award points for exploring resources
                if (typeof addResourcePoints === 'function') {
                    addResourcePoints();
                }
            }

            // Helper function to determine file type from URL
            function getFileType(url) {
                if (!url) return "unknown";
                url = url.toLowerCase();
                
                if (url.endsWith('.pdf')) {
                    return "pdf";
                } else if (url.match(/\.(jpeg|jpg|gif|png|svg|webp)$/)) {
                    return "image";
                } else if (url.match(/\.(mp4|webm|ogg|mov)$/)) {
                    return "video";
                } else if (url.match(/\.(doc|docx|ppt|pptx|xls|xlsx)$/)) {
                    return "office";
                } else {
                    return "unknown";
                }
            }

            function renderBookflip() {
                bookflipViewer.innerHTML = '';
                if (!currentResource) return;
                const pages = currentResource.pages || [];
                if (pages.length === 0) {
                    bookflipViewer.innerHTML = `<div style="color:#d35400; font-weight:bold; padding:24px; text-align:center;">No pages available for this resource.</div>`;
                    return;
                }
                const pageData = pages[currentPage];

                // Bookflip UI
                const pageDiv = document.createElement('div');
                pageDiv.style.background = "#f9fafb";
                pageDiv.style.borderRadius = "12px";
                pageDiv.style.boxShadow = "0 1px 4px #0001";
                pageDiv.style.padding = "24px";
                pageDiv.style.minHeight = "120px";
                pageDiv.style.fontSize = "1.08em";
                pageDiv.style.marginBottom = "12px";

                // Dynamic content type
                if (pageData && typeof pageData === "object") {
                    if (pageData.type === "image") {
                        pageDiv.innerHTML = `<img src="${pageData.url}" alt="Resource Image" style="max-width:100%;max-height:320px;border-radius:8px;">`;
                    } else if (pageData.type === "video") {
                        pageDiv.innerHTML = `<video controls style="max-width:100%;border-radius:8px;"><source src="${pageData.url}" type="video/mp4">Your browser does not support video.</video>`;
                    } else if (pageData.type === "pdf") {
                        pageDiv.innerHTML = `<iframe src="${pageData.url}" style="width:100%;height:320px;border-radius:8px;border:none;"></iframe>`;
                    } else {
                        pageDiv.textContent = pageData.text || "";
                    }
                } else {
                    pageDiv.textContent = pageData || "";
                }

                // Bookflip controls
                const controlsDiv = document.createElement('div');
                controlsDiv.style.display = "flex";
                controlsDiv.style.justifyContent = "center";
                controlsDiv.style.gap = "18px";
                controlsDiv.style.marginBottom = "8px";

                const prevBtn = document.createElement('button');
                prevBtn.textContent = "‚ü® Prev";
                prevBtn.style.background = "#eee";
                prevBtn.style.border = "none";
                prevBtn.style.borderRadius = "8px";
                prevBtn.style.padding = "6px 18px";
                prevBtn.style.fontWeight = "bold";
                prevBtn.style.cursor = "pointer";
                prevBtn.disabled = currentPage === 0;
                prevBtn.onclick = () => {
                    currentPage = Math.max(0, currentPage - 1);
                    renderBookflip();
                };

                const nextBtn = document.createElement('button');
                nextBtn.textContent = "Next ‚ü©";
                nextBtn.style.background = "#eee";
                nextBtn.style.border = "none";
                nextBtn.style.borderRadius = "8px";
                nextBtn.style.padding = "6px 18px";
                nextBtn.style.fontWeight = "bold";
                nextBtn.style.cursor = "pointer";
                nextBtn.disabled = currentPage === currentResource.pages.length - 1;
                nextBtn.onclick = () => {
                    currentPage = Math.min(currentResource.pages.length - 1, currentPage + 1);
                    renderBookflip();
                };

                controlsDiv.appendChild(prevBtn);
                controlsDiv.appendChild(nextBtn);

                bookflipViewer.appendChild(pageDiv);
                bookflipViewer.appendChild(controlsDiv);
                
                // Page indicator
                const pageIndicator = document.createElement('div');
                pageIndicator.style.fontSize = "0.97em";
                pageIndicator.style.color = "#888";
                pageIndicator.textContent = `Page ${currentPage + 1} of ${currentResource.pages.length}`;
                bookflipViewer.appendChild(pageIndicator);
            }

            function renderRating() {
                if (!currentResource) return;
                
                // Check if user has already rated this resource
                const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                const userRating = userRatings[currentResource.id] || 0;
                
                let ratingHTML = '<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">';
                ratingHTML += '<span style="color:#888; font-size:1em;">Rate this resource:</span>';
                
                // Create interactive star rating
                for (let i = 1; i <= 5; i++) {
                    const starColor = i <= userRating ? '#f39c12' : '#ddd';
                    ratingHTML += `<span onclick="rateResource(${i})" style="color:${starColor}; font-size:1.5em; cursor:pointer; transition:color 0.2s;" onmouseover="this.style.color='#f39c12'" onmouseout="this.style.color='${starColor}'">‚òÖ</span>`;
                }
                
                ratingHTML += '</div>';
                
                // Show current average rating
                ratingHTML += `
                    <div style="margin-bottom: 10px;">
                        <span style="color:#f39c12; font-size:1.2em;">${"‚òÖ".repeat(Math.round(currentResource.rating || 0))}${"‚òÜ".repeat(5-Math.round(currentResource.rating || 0))}</span>
                        <span style="color:#888; font-size:1em;">(${currentResource.totalRaters || 0} reviews)</span>
                    </div>
                `;
                
                // Add share button
                ratingHTML += `
                    <button onclick="shareResource('${currentResource.id}')" style="background: linear-gradient(135deg, #27ae60 0%, #219653 100%); color: white; border: none; border-radius: 8px; padding: 8px 16px; font-weight: bold; cursor: pointer; margin-top: 10px;">
                        üîó Share Resource
                    </button>
                `;
                
                resourceRating.innerHTML = ratingHTML;
            }

            function renderComments() {
                if (!currentResource) return;
                resourceComments.innerHTML = '';
                (currentResource.comments || []).forEach(c => {
                    const commentDiv = document.createElement('div');
                    commentDiv.style.marginBottom = "8px";
                    commentDiv.style.padding = "8px 12px";
                    commentDiv.style.background = "#f8f9fa";
                    commentDiv.style.borderRadius = "8px";
                    commentDiv.style.borderLeft = "3px solid #007bff";
                    commentDiv.innerHTML = `<b style="color:#007bff;">${c.user}:</b> <span style="color:#2c3e50;">${c.text}</span>`;
                    resourceComments.appendChild(commentDiv);
                });
            }

            closeResourceBtn.onclick = function() {
                resourceModal.style.display = 'none';
            };
            
            resourceModal.onclick = function(e) {
                if (e.target === resourceModal) resourceModal.style.display = 'none';
            };

            addCommentBtn.onclick = function() {
                if (!currentResource || !commentInput.value.trim()) return;
                if (!currentResource.comments) currentResource.comments = [];
                currentResource.comments.push({ user: "You", text: commentInput.value.trim() });
                commentInput.value = '';
                renderComments();
                
                // Award points for commenting
                if (typeof addFeedbackPoints === 'function') {
                    addFeedbackPoints();
                }
            };

            // Function to rate a resource
            window.rateResource = function(rating) {
                if (!currentResource) return;
                
                // Save user rating
                const userRatings = JSON.parse(localStorage.getItem('userRatings')) || {};
                userRatings[currentResource.id] = rating;
                localStorage.setItem('userRatings', JSON.stringify(userRatings));
                
                // Update resource rating (simplified - in real app this would update database)
                if (!currentResource.totalRaters) currentResource.totalRaters = 0;
                if (!currentResource.rating) currentResource.rating = 0;
                
                currentResource.totalRaters += 1;
                currentResource.rating = ((currentResource.rating * (currentResource.totalRaters - 1)) + rating) / currentResource.totalRaters;
                
                // Award points for rating
                if (typeof addRatingPoints === 'function') {
                    addRatingPoints();
                }
                
                // Re-render rating display
                renderRating();
                
                alert(`Thank you for rating! You earned 2 points.`);
            };

            // Function to share a resource
            window.shareResource = function(resourceId) {
                if (!currentResource) return;
                
                // Create shareable link (in real app this would be a proper URL)
                const shareText = `Check out this amazing STEM resource: ${currentResource.fileName} on STEMShare!`;
                
                // Simulate sharing (in real app this would use Web Share API or social media)
                if (navigator.share) {
                    navigator.share({
                        title: 'STEMShare Resource',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('Resource link copied to clipboard!');
                    });
                }
                
                // Award points for sharing
                if (typeof addShareResourcePoints === 'function') {
                    addShareResourcePoints();
                }
                
                alert('Resource shared successfully! You earned 5 points.');
            };

            // Switch upload method function
            window.switchUploadMethod = function(method) {
                const urlSection = document.getElementById('urlUploadSection');
                const fileSection = document.getElementById('fileUploadSection');
                const urlBtn = document.getElementById('urlMethodBtn');
                const fileBtn = document.getElementById('fileMethodBtn');
                const gameUrlInput = document.getElementById('gameUrl');
                
                if (method === 'url') {
                    // Show URL section, hide file section
                    urlSection.style.display = 'flex';
                    fileSection.style.display = 'none';
                    
                    // Update button styles
                    urlBtn.style.background = 'linear-gradient(135deg, #3498db 0%, #2980b9 100%)';
                    fileBtn.style.background = '#95a5a6';
                    
                    // Make URL required, file not required
                    gameUrlInput.required = true;
                    const gameFileInput = document.getElementById('gameFile');
                    if (gameFileInput) gameFileInput.required = false;
                    
                } else if (method === 'file') {
                    // Show file section, hide URL section
                    urlSection.style.display = 'none';
                    fileSection.style.display = 'flex';
                    
                    // Update button styles
                    fileBtn.style.background = 'linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%)';
                    urlBtn.style.background = '#95a5a6';
                    
                    // Make file required, URL not required
                    gameUrlInput.required = false;
                    const gameFileInput = document.getElementById('gameFile');
                    if (gameFileInput) gameFileInput.required = true;
                }
            };

            // Function to handle file-based game viewing
            window.viewFileGame = function(fileName, gameTitle) {
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.width = '100%';
                modal.style.height = '100%';
                modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                modal.style.display = 'flex';
                modal.style.justifyContent = 'center';
                modal.style.alignItems = 'center';
                modal.style.zIndex = '10000';
                modal.style.padding = '20px';
                
                const fileExtension = fileName.split('.').pop().toLowerCase();
                let fileTypeInfo = '';
                let actionText = '';
                
                switch(fileExtension) {
                    case 'zip':
                    case 'rar':
                        fileTypeInfo = 'üì¶ Compressed Archive';
                        actionText = 'Extract and run the game files on your computer.';
                        break;
                    case 'exe':
                        fileTypeInfo = '‚öôÔ∏è Executable Program';
                        actionText = 'Run this program on a Windows computer.';
                        break;
                    case 'html':
                    case 'htm':
                        fileTypeInfo = 'üåê Web Game';
                        actionText = 'Open this HTML file in your web browser.';
                        break;
                    case 'swf':
                        fileTypeInfo = 'üéÆ Flash Game';
                        actionText = 'Requires Adobe Flash Player to run.';
                        break;
                    case 'jar':
                        fileTypeInfo = '‚òï Java Application';
                        actionText = 'Requires Java Runtime Environment to run.';
                        break;
                    case 'apk':
                        fileTypeInfo = 'üì± Android App';
                        actionText = 'Install this APK file on an Android device.';
                        break;
                    default:
                        fileTypeInfo = 'üìÑ Game File';
                        actionText = 'This file contains game data.';
                }
                
                modal.innerHTML = `
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 20px; padding: 30px; width: 90%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center; position: relative;">
                        <button onclick="document.body.removeChild(this.closest('.modal-backdrop'))" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                        
                        <div style="font-size: 4em; margin-bottom: 20px;">üìÅ</div>
                        <h2 style="margin: 0 0 10px 0; color: #2c3e50;">${gameTitle}</h2>
                        <div style="color: #7f8c8d; margin-bottom: 20px; font-size: 1.1em;">${fileTypeInfo}</div>
                        <div style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <strong>üìÑ File:</strong> ${fileName}
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #f39c12;">
                            <strong>‚ÑπÔ∏è How to use:</strong><br>
                            ${actionText}
                        </div>
                        <div style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 12px; border-radius: 10px; font-size: 0.9em;">
                            <strong>‚ö†Ô∏è Note:</strong> For security reasons, files cannot be directly downloaded or executed from the browser. In a real application, you would download this file and run it on your device.
                        </div>
                        <div style="margin-top: 20px;">
                            <button onclick="addGamePoints(); document.body.removeChild(this.closest('.modal-backdrop'))" style="background: linear-gradient(135deg, #27ae60 0%, #219653 100%); color: white; border: none; border-radius: 10px; padding: 12px 24px; font-weight: bold; cursor: pointer; margin-right: 10px;">
                                üéÆ Mark as Played (+10 points)
                            </button>
                            <button onclick="document.body.removeChild(this.closest('.modal-backdrop'))" style="background: #95a5a6; color: white; border: none; border-radius: 10px; padding: 12px 24px; font-weight: bold; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                `;
                
                modal.classList.add('modal-backdrop');
                document.body.appendChild(modal);
                
                // Close modal when clicking outside
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            };

            // Custom AI Chatbot functionality
            function sendCustomChatMessage() {
                const input = document.getElementById('customChatInput');
                const message = input.value.trim();
                if (!message) return;
                
                addCustomMessage(message, true);
                input.value = '';
                
                // Show typing indicator
                const typingIndicator = addCustomMessage("‚ú® Thinking...", false, true);
                
                // Simulate AI response after a short delay
                setTimeout(() => {
                    const response = generateAIResponse(message);
                    typingIndicator.textContent = response;
                    typingIndicator.classList.remove('typing');
                }, 1000);
            }
            
            function addCustomMessage(message, isUser = false, isTyping = false) {
                const messagesContainer = document.getElementById('customChatMessages');
                const messageDiv = document.createElement('div');
                
                messageDiv.style.maxWidth = '80%';
                messageDiv.style.padding = '12px 16px';
                messageDiv.style.borderRadius = '18px';
                messageDiv.style.fontSize = '0.95em';
                messageDiv.style.lineHeight = '1.4';
                messageDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                messageDiv.style.animation = 'slideIn 0.3s ease-out';
                
                if (isUser) {
                    messageDiv.style.background = 'linear-gradient(135deg, #007bff 0%, #0056b3 100%)';
                    messageDiv.style.color = 'white';
                    messageDiv.style.alignSelf = 'flex-end';
                    messageDiv.style.borderBottomRightRadius = '4px';
                } else {
                    messageDiv.style.background = 'linear-gradient(135deg, #fff 0%, #f8f9fa 100%)';
                    messageDiv.style.color = '#333';
                    messageDiv.style.alignSelf = 'flex-start';
                    messageDiv.style.borderBottomLeftRadius = '4px';
                    messageDiv.style.borderLeft = '4px solid #4CAF50';
                }
                
                if (isTyping) {
                    messageDiv.classList.add('typing');
                    messageDiv.style.opacity = '0.7';
                }
                
                // Handle formatted text with line breaks
                messageDiv.innerHTML = message.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                return messageDiv;
            }
            
            function generateAIResponse(userMessage) {
                const message = userMessage.toLowerCase();
                
                // ALGEBRA SPECIFIC
                if (message.includes('algebra')) {
                    return "üî¢ **ALGEBRA HELP** üìê\n\nAlgebra is about finding unknown values (like x). Key concepts:\n\n‚Ä¢ **Variables**: Letters like x, y represent unknown numbers\n‚Ä¢ **Equations**: Mathematical statements with = sign (like 2x + 3 = 7)\n‚Ä¢ **Solving**: Find what x equals by doing same operation to both sides\n\n**Example**: Solve 2x + 3 = 7\n1) Subtract 3: 2x = 4\n2) Divide by 2: x = 2\n\nNeed help with a specific algebra problem?";
                }
                
                // QUADRATIC EQUATIONS
                if (message.includes('quadratic')) {
                    return "üìà **QUADRATIC EQUATIONS** üéØ\n\nQuadratic equations have x¬≤ (x squared). Standard form: ax¬≤ + bx + c = 0\n\n**Solving Methods**:\n‚Ä¢ **Factoring**: Break into (x + m)(x + n) = 0\n‚Ä¢ **Quadratic Formula**: x = [-b ¬± ‚àö(b¬≤-4ac)] / 2a\n‚Ä¢ **Completing the Square**: Make perfect square trinomial\n\n**Example**: x¬≤ - 5x + 6 = 0\nFactors to: (x - 2)(x - 3) = 0\nSolutions: x = 2 or x = 3\n\nWhat quadratic concept would you like me to explain more?";
                }
                
                // FRACTIONS
                if (message.includes('fraction')) {
                    return "üçï **FRACTIONS MADE EASY** ‚ú®\n\n**What are fractions?** Parts of a whole!\n‚Ä¢ **Numerator** (top): How many parts you have\n‚Ä¢ **Denominator** (bottom): Total parts in the whole\n\n**Operations**:\n‚Ä¢ **Adding**: Same denominator? Add numerators! (1/4 + 2/4 = 3/4)\n‚Ä¢ **Multiplying**: Multiply across! (1/2 √ó 3/4 = 3/8)\n‚Ä¢ **Dividing**: Flip and multiply! (1/2 √∑ 3/4 = 1/2 √ó 4/3 = 4/6 = 2/3)\n\n**Tip**: Think of pizza slices - 3/8 means 3 slices out of 8 total!\n\nWhat fraction problem can I help solve?";
                }
                
                // GEOMETRY
                if (message.includes('geometry')) {
                    return "üìê **GEOMETRY GUIDE** üî∫\n\n**Shapes & Properties**:\n‚Ä¢ **Triangle**: 3 sides, angles add to 180¬∞\n‚Ä¢ **Square**: 4 equal sides, 4 right angles (90¬∞)\n‚Ä¢ **Circle**: Distance from center = radius\n\n**Key Formulas**:\n‚Ä¢ **Area of Rectangle**: length √ó width\n‚Ä¢ **Area of Triangle**: ¬Ω √ó base √ó height\n‚Ä¢ **Area of Circle**: œÄ √ó radius¬≤\n‚Ä¢ **Pythagorean Theorem**: a¬≤ + b¬≤ = c¬≤ (right triangles)\n\n**Example**: Right triangle with sides 3 and 4\nHypotenuse = ‚àö(3¬≤ + 4¬≤) = ‚àö(9 + 16) = ‚àö25 = 5\n\nWhich geometric concept needs clarification?";
                }
                
                // PHYSICS
                if (message.includes('physics') || message.includes('force') || message.includes('velocity')) {
                    return "‚ö° **PHYSICS FUNDAMENTALS** üåç\n\n**Key Concepts**:\n‚Ä¢ **Force**: Push or pull on object (measured in Newtons)\n‚Ä¢ **Velocity**: Speed with direction (m/s)\n‚Ä¢ **Acceleration**: Change in velocity over time (m/s¬≤)\n‚Ä¢ **Gravity**: 9.8 m/s¬≤ pulls objects down\n\n**Newton's Laws**:\n1. **Objects at rest stay at rest** (unless force applied)\n2. **F = ma** (Force = mass √ó acceleration)\n3. **Every action has equal opposite reaction**\n\n**Example**: Dropping a ball\n‚Ä¢ Gravity pulls it down at 9.8 m/s¬≤\n‚Ä¢ After 1 second: velocity = 9.8 m/s downward\n\nWhat physics topic interests you most?";
                }
                
                // CHEMISTRY
                if (message.includes('chemistry') || message.includes('atom') || message.includes('molecule')) {
                    return "üß™ **CHEMISTRY BASICS** ‚öõÔ∏è\n\n**Atomic Structure**:\n‚Ä¢ **Protons**: Positive charge, in nucleus\n‚Ä¢ **Electrons**: Negative charge, orbit nucleus\n‚Ä¢ **Neutrons**: No charge, in nucleus with protons\n\n**Chemical Bonds**:\n‚Ä¢ **Ionic**: Transfer electrons (NaCl - table salt)\n‚Ä¢ **Covalent**: Share electrons (H‚ÇÇO - water)\n\n**Periodic Table Tips**:\n‚Ä¢ **Groups** (columns): Same number of outer electrons\n‚Ä¢ **Periods** (rows): Same number of electron shells\n\n**Example**: Water (H‚ÇÇO)\n‚Ä¢ 2 Hydrogen atoms + 1 Oxygen atom\n‚Ä¢ Covalent bonds (sharing electrons)\n\nWhat chemistry concept can I break down for you?";
                }
                
                // BIOLOGY
                if (message.includes('biology') || message.includes('cell') || message.includes('photosynthesis')) {
                    return "üå± **BIOLOGY ESSENTIALS** ü¶†\n\n**Cell Theory**:\n‚Ä¢ All living things made of cells\n‚Ä¢ Cells are basic unit of life\n‚Ä¢ All cells come from existing cells\n\n**Types of Cells**:\n‚Ä¢ **Plant**: Have cell wall, chloroplasts for photosynthesis\n‚Ä¢ **Animal**: Have nucleus, mitochondria for energy\n\n**Photosynthesis**: How plants make food!\n**Equation**: 6CO‚ÇÇ + 6H‚ÇÇO + light ‚Üí C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ + 6O‚ÇÇ\n(Carbon dioxide + Water + Light ‚Üí Sugar + Oxygen)\n\n**Fun Fact**: Plants are like nature's solar panels - they convert sunlight into food!\n\nWhich biology topic would you like to explore deeper?";
                }
                
                // EQUATIONS AND PROBLEM SOLVING
                if (message.includes('solve') && (message.includes('equation') || message.includes('problem'))) {
                    return "üéØ **EQUATION SOLVING STRATEGY** üìù\n\n**Step-by-Step Method**:\n1. **Identify** what you're solving for\n2. **Isolate** the variable (get it alone)\n3. **Use inverse operations** (opposite operations)\n4. **Check** your answer by substituting back\n\n**Order of Operations** (PEMDAS):\n‚Ä¢ **P**arentheses first\n‚Ä¢ **E**xponents (powers)\n‚Ä¢ **M**ultiplication and **D**ivision (left to right)\n‚Ä¢ **A**ddition and **S**ubtraction (left to right)\n\n**Example**: Solve 3(x + 2) = 15\n1. Divide both sides by 3: x + 2 = 5\n2. Subtract 2: x = 3\n3. Check: 3(3 + 2) = 3(5) = 15 ‚úì\n\nShare your specific equation and I'll walk you through it!";
                }
                
                // PERCENTAGES AND PROPORTIONS
                if (message.includes('percent') || message.includes('proportion')) {
                    return "üìä **PERCENTAGES & PROPORTIONS** üíØ\n\n**Percentage Basics**:\n‚Ä¢ Percent means \"per 100\" (50% = 50/100 = 0.5)\n‚Ä¢ To find % of number: multiply by decimal (25% of 80 = 0.25 √ó 80 = 20)\n\n**Proportion Problems**:\nIf 3 apples cost $2, how much do 9 apples cost?\n**Setup**: 3/2 = 9/x\n**Cross multiply**: 3x = 18\n**Solve**: x = $6\n\n**Percentage Change**:\n‚Ä¢ **Increase**: (New - Old)/Old √ó 100%\n‚Ä¢ **Decrease**: (Old - New)/Old √ó 100%\n\n**Tip**: 10% is easy - just move decimal left once! (10% of 45 = 4.5)\n\nWhat percentage problem can I help solve?";
                }
                
                // BASIC GREETINGS
                if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                    return "üëã **Welcome to STEMSHARE AI!** ‚ú®\n\nI'm your smart study companion! I can help with:\n\nüìê **Math**: Algebra, geometry, fractions, equations\nüî¨ **Science**: Physics, chemistry, biology\nüìù **Study Skills**: Problem-solving strategies\n\n**Try asking me**:\n‚Ä¢ \"Help me solve 2x + 5 = 11\"\n‚Ä¢ \"Explain photosynthesis\"\n‚Ä¢ \"What's the Pythagorean theorem?\"\n‚Ä¢ \"How do I factor quadratics?\"\n\nWhat would you like to learn today?";
                }
                
                // THANKS
                if (message.includes('thank') || message.includes('thanks')) {
                    return "üåü **You're absolutely welcome!** üéì\n\nI love helping students succeed! Remember:\n‚Ä¢ Practice makes progress (not perfection)\n‚Ä¢ Every expert was once a beginner\n‚Ä¢ Mistakes are learning opportunities\n\nKeep asking questions - that's how you grow smarter! üöÄ\n\nWhat else can I help you master today?";
                }
                
                // MATH GENERAL
                if (message.includes('math') || message.includes('mathematics')) {
                    return "üî¢ **MATHEMATICS MASTERY** üìä\n\n**Core Topics I Can Help With**:\n‚Ä¢ **Algebra**: Solving equations, variables, functions\n‚Ä¢ **Geometry**: Shapes, areas, angles, theorems\n‚Ä¢ **Fractions**: Adding, subtracting, multiplying, dividing\n‚Ä¢ **Percentages**: Converting, calculating, word problems\n‚Ä¢ **Word Problems**: Breaking down into steps\n\n**Study Tips**:\n1. **Practice daily** - even 10 minutes helps!\n2. **Show your work** - see where you went wrong\n3. **Check answers** - substitute back into original\n\n**Popular Questions**:\n‚Ä¢ \"How do I solve for x?\"\n‚Ä¢ \"What's the area of a triangle?\"\n‚Ä¢ \"How do fractions work?\"\n\nWhat specific math topic can I help explain?";
                }
                
                // SCIENCE GENERAL
                if (message.includes('science')) {
                    return "üî¨ **SCIENCE EXPLORATION** üåü\n\n**Branches I Cover**:\n‚Ä¢ **Physics**: Forces, motion, energy, waves\n‚Ä¢ **Chemistry**: Atoms, molecules, reactions\n‚Ä¢ **Biology**: Cells, photosynthesis, life processes\n\n**Scientific Method**:\n1. **Observe** - What do you notice?\n2. **Hypothesize** - What might cause this?\n3. **Experiment** - Test your idea\n4. **Conclude** - What did you learn?\n\n**Cool Facts**:\n‚Ä¢ Light travels 186,000 miles per second!\n‚Ä¢ Your body has 37 trillion cells!\n‚Ä¢ Water expands when it freezes!\n\n**Ask me about**: \"How do atoms work?\", \"Why do things fall?\", \"How do plants make food?\"\n\nWhat scientific mystery shall we solve together?";
                }
                
                // DEFAULT SMART RESPONSE
                return "ü§ñ **STEMSHARE AI Assistant** üí°\n\nI'm ready to help you learn! I have knowledge in:\n\n**Mathematics** üìê\n‚Ä¢ Algebra, geometry, fractions, percentages\n‚Ä¢ Step-by-step equation solving\n‚Ä¢ Word problem strategies\n\n**Science** üî¨\n‚Ä¢ Physics (forces, motion, energy)\n‚Ä¢ Chemistry (atoms, molecules, reactions)\n‚Ä¢ Biology (cells, photosynthesis, life)\n\n**Try specific questions like**:\n‚Ä¢ \"Solve 2x + 3 = 11\"\n‚Ä¢ \"What is photosynthesis?\"\n‚Ä¢ \"How do I find the area of a circle?\"\n\nThe more specific your question, the better I can help! What subject interests you?";
            }

            // Initialize - fetch resources from Firebase
            fetchResources();
            
            // Load saved video interactions
            loadVideoInteractions();
            
            // Gamification System
            let points = 0;
            let level = "BASIC"; // BASIC, PREMIUM, MAJESTIC
            
            // DOM elements
            const pointsValue = document.getElementById('pointsValue');
            const progressBar = document.getElementById('progressBar');
            const levelBadge = document.querySelector('.level-badge');
            
            // Initialize gamification system
            function initGamification() {
                // Check if points are stored in localStorage
                const savedPoints = localStorage.getItem('studentPoints');
                if (savedPoints) {
                    points = parseInt(savedPoints);
                }
                
                // Check if level is stored in localStorage
                const savedLevel = localStorage.getItem('studentLevel');
                if (savedLevel) {
                    level = savedLevel;
                }
                
                updateUI();
            }
            
            // Update UI elements
            function updateUI() {
                // Update points display
                pointsValue.textContent = points;
                
                // Update level badge
                levelBadge.textContent = `LEVEL ${level}`;
                
                // Update progress bar
                let progressPercentage = 0;
                if (level === "BASIC") {
                    progressPercentage = (points / 50) * 100;
                } else if (level === "PREMIUM") {
                    progressPercentage = ((points - 50) / 50) * 100;
                } else if (level === "MAJESTIC") {
                    progressPercentage = 100;
                }
                
                // Ensure progress doesn't exceed 100%
                progressPercentage = Math.min(progressPercentage, 100);
                
                // Update progress bar width
                progressBar.style.width = `${progressPercentage}%`;
                
                // Update studentLevel variable for resource access
                window.studentLevel = level;
                
                // Update upload game section based on level
                updateUploadGameSection();
            }
            
            // Update upload game section based on student level
            function updateUploadGameSection() {
                const uploadGameSection = document.getElementById('uploadGameSection');
                const currentLevel = level || 'BASIC';
                
                if (currentLevel === 'MAJESTIC') {
                    // Show functional upload form for MAJESTIC users
                    uploadGameSection.innerHTML = `
                        <h3 style="margin-top:0;">üéÆ Upload Your Game (Developer)</h3>
                        <div style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center;">
                            <strong>üåü MAJESTIC LEVEL UNLOCKED!</strong> You can now upload games to share with the community!
                        </div>
                        
                        <!-- Upload Method Selector -->
                        <div style="margin-bottom: 16px;">
                            <label style="font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block;">Choose Upload Method:</label>
                            <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                                <button type="button" id="urlMethodBtn" class="upload-method-btn active" onclick="switchUploadMethod('url')" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none; border-radius: 8px; padding: 8px 16px; font-weight: bold; cursor: pointer;">üîó URL Link</button>
                                <button type="button" id="fileMethodBtn" class="upload-method-btn" onclick="switchUploadMethod('file')" style="background: #95a5a6; color: white; border: none; border-radius: 8px; padding: 8px 16px; font-weight: bold; cursor: pointer;">üìÅ Upload File</button>
                            </div>
                        </div>
                        
                        <form id="uploadGameForm" style="display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;">
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <label style="font-size: 0.9em; color: #666;">Your Name</label>
                                <input type="text" id="uploaderName" placeholder="Your Name" required style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; min-width: 120px;">
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                <label style="font-size: 0.9em; color: #666;">Game Title</label>
                                <input type="text" id="gameTitle" placeholder="Game Title" required style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; min-width: 150px;">
                            </div>
                            
                            <!-- URL Upload Section -->
                            <div id="urlUploadSection" style="display: flex; flex-direction: column; gap: 4px; flex: 1;">
                                <label style="font-size: 0.9em; color: #666;">Game URL</label>
                                <input type="url" id="gameUrl" placeholder="Game URL (e.g. https://...)" style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; flex:1;">
                            </div>
                            
                            <!-- File Upload Section -->
                            <div id="fileUploadSection" style="display: none; flex-direction: column; gap: 4px; flex: 1;">
                                <label style="font-size: 0.9em; color: #666;">Game File</label>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <input type="file" id="gameFile" accept=".zip,.rar,.exe,.html,.htm,.swf,.jar,.apk" style="padding:4px; border-radius:8px; border:1px solid #ccc; flex: 1;">
                                    <div id="fileInfo" style="font-size: 0.8em; color: #666;"></div>
                                </div>
                                <div style="font-size: 0.75em; color: #999; margin-top: 2px;">Supported: ZIP, RAR, EXE, HTML, SWF, JAR, APK (Max: 50MB)</div>
                            </div>
                            
                            <button type="submit" style="background:linear-gradient(135deg,#00b894 0%,#00cec9 100%); color:white; border:none; border-radius:8px; padding:8px 20px; font-weight:bold; cursor:pointer;">Upload Game</button>
                        </form>
                    `;
                    
                    // Add event listener to the dynamically created form
                    const form = document.getElementById('uploadGameForm');
                    if (form) {
                        form.onsubmit = function(e) {
                            e.preventDefault();
                            const title = document.getElementById('gameTitle').value.trim();
                            const uploader = document.getElementById('uploaderName').value.trim();
                            const urlInput = document.getElementById('gameUrl');
                            const fileInput = document.getElementById('gameFile');
                            
                            // Check which upload method is active
                            const isFileUpload = document.getElementById('fileUploadSection').style.display !== 'none';
                            
                            if (isFileUpload) {
                                // File upload method
                                if (title && uploader && fileInput.files.length > 0) {
                                    const file = fileInput.files[0];
                                    
                                    // Check file size (max 50MB)
                                    if (file.size > 50 * 1024 * 1024) {
                                        alert('File size exceeds 50MB limit. Please choose a smaller file.');
                                        return;
                                    }
                                    
                                    // Create a unique identifier for the file
                                    const fileId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                                    const fileName = file.name;
                                    
                                    // In a real application, you would upload to a server
                                    // For this demo, we'll create a local reference
                                    const gameEntry = {
                                        title: title,
                                        url: '#file_' + fileId, // Placeholder URL for file-based games
                                        fileName: fileName,
                                        fileSize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                                        uploadType: 'file',
                                        likes: 0,
                                        shares: 0,
                                        uploader: uploader
                                    };
                                    
                                    games.push(gameEntry);
                                    saveGames();
                                    form.reset();
                                    renderGames();
                                    
                                    alert('üéÆ Game file uploaded successfully!' + String.fromCharCode(10) + String.fromCharCode(10) + 'Note: In a production environment, this would be uploaded to a server. For now, it is stored locally for demonstration.');
                                    
                                    // Add points for uploading a game file (higher bonus)
                                    addPoints(20);
                                } else {
                                    alert('Please fill in all fields and select a game file.');
                                }
                            } else {
                                // URL upload method
                                const url = urlInput.value.trim();
                                if (title && url && uploader) {
                                    const gameEntry = {
                                        title: title,
                                        url: url,
                                        uploadType: 'url',
                                        likes: 0,
                                        shares: 0,
                                        uploader: uploader
                                    };
                                    
                                    games.push(gameEntry);
                                    saveGames();
                                    form.reset();
                                    renderGames();
                                    
                                    alert('üéÆ Game URL uploaded successfully!');
                                    
                                    // Add points for uploading a game
                                    addPoints(15);
                                } else {
                                    alert('Please fill in all fields to upload your game.');
                                }
                            }
                        };
                        
                        // Add file input change listener for file info display
                        const fileInput = document.getElementById('gameFile');
                        if (fileInput) {
                            fileInput.addEventListener('change', function(e) {
                                const fileInfo = document.getElementById('fileInfo');
                                if (e.target.files.length > 0) {
                                    const file = e.target.files[0];
                                    const sizeMB = (file.size / 1024 / 1024).toFixed(2);
                                    fileInfo.textContent = `${sizeMB} MB`;
                                    fileInfo.style.color = file.size > 50 * 1024 * 1024 ? '#e74c3c' : '#27ae60';
                                } else {
                                    fileInfo.textContent = '';
                                }
                            });
                        }
                    }
                } else {
                    // Show locked version for BASIC and PREMIUM users
                    const pointsNeeded = 100 - points;
                    const nextLevel = currentLevel === 'BASIC' ? 'PREMIUM (50 points)' : 'MAJESTIC (100 points)';
                    
                    uploadGameSection.innerHTML = `
                        <div style="position: relative; opacity: 0.6;">
                            <h3 style="margin-top:0;">üéÆ Upload Your Game (Developer)</h3>
                            <div style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center;">
                                <strong>üîí MAJESTIC LEVEL REQUIRED</strong><br>
                                <span style="font-size: 0.9em;">You need ${pointsNeeded} more points to unlock game uploading!</span>
                            </div>
                            <form style="display:flex; gap:12px; flex-wrap:wrap; align-items:center; pointer-events: none;">
                                <input type="text" placeholder="Your Name" disabled style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; background: #f5f5f5; color: #999;">
                                <input type="text" placeholder="Game Title" disabled style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; background: #f5f5f5; color: #999;">
                                <input type="url" placeholder="Game URL (e.g. https://...)" disabled style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; flex:1; background: #f5f5f5; color: #999;">
                                <button type="button" disabled style="background:#95a5a6; color:white; border:none; border-radius:8px; padding:8px 20px; font-weight:bold; cursor:not-allowed;">üîí Locked</button>
                            </form>
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255,255,255,0.95); border-radius: 12px; padding: 20px; text-align: center; border: 2px solid #e74c3c;">
                                <div style="font-size: 2em; margin-bottom: 10px;">üîí</div>
                                <div style="font-weight: bold; color: #e74c3c; margin-bottom: 8px;">Game Upload Locked</div>
                                <div style="color: #555; font-size: 0.9em; margin-bottom: 10px;">
                                    Reach <strong>MAJESTIC level</strong> to unlock game uploading
                                </div>
                                <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 8px 12px; border-radius: 6px; font-size: 0.85em;">
                                    Current: <strong>${currentLevel} Level</strong> ‚Ä¢ Need: <strong>${pointsNeeded} more points</strong>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // Add points to student
            function addPoints(amount) {
                points += amount;
                
                // Check for level progression
                if (points >= 100 && level !== "MAJESTIC") {
                    level = "MAJESTIC";
                    showLevelUpNotification("MAJESTIC");
                } else if (points >= 50 && level === "BASIC") {
                    level = "PREMIUM";
                    showLevelUpNotification("PREMIUM");
                }
                
                // Save to localStorage
                localStorage.setItem('studentPoints', points.toString());
                localStorage.setItem('studentLevel', level);
                
                // Update UI
                updateUI();
                
                // Update the global currentPoints variable to keep everything in sync
                if (typeof currentPoints !== 'undefined') {
                    currentPoints = points;
                }
            }
            
            // Show level up notification
            function showLevelUpNotification(newLevel) {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.backgroundColor = '#4CAF50';
                notification.style.color = 'white';
                notification.style.padding = '15px 20px';
                notification.style.borderRadius = '8px';
                notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                notification.style.zIndex = '1000';
                notification.style.fontWeight = 'bold';
                notification.innerHTML = `üéâ Congratulations! You've reached ${newLevel} level!`;
                
                // Add to document
                document.body.appendChild(notification);
                
                // Remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            }
            
            // Initialize gamification when page loads
            document.addEventListener('DOMContentLoaded', function() {
                // Use saved points from localStorage or start at 0
                const savedPoints = localStorage.getItem('studentPoints');
                if (savedPoints) {
                    points = parseInt(savedPoints);
                } else {
                    points = 0;
                }
                // Use saved level or start BASIC
                const savedLevel = localStorage.getItem('studentLevel');
                if (savedLevel) {
                    level = savedLevel;
                } else {
                    level = 'BASIC';
                }
                initGamification();
                
                // Example: Add points for playing a game
                // This would be called when a game is completed
                window.addGamePoints = function() {
                    addPoints(10);
                    // Track game plays
                    let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed')) || 0;
                    gamesPlayed += 1;
                    localStorage.setItem('gamesPlayed', gamesPlayed.toString());
                };
                
                // Example: Add points for uploading a note
                // This would be called when a note is uploaded
                window.addNotePoints = function() {
                    addPoints(5);
                    
                    // Track note uploads
                    let notesUploaded = parseInt(localStorage.getItem('notesUploaded')) || 0;
                    notesUploaded += 1;
                    localStorage.setItem('notesUploaded', notesUploaded.toString());
                };
                
                // AI-Powered Note Transformation to Infographic Function
                function transformNotesToInfographic() {
                    // Create modal with iframe to the new AI Visual Generator
                    const modal = document.createElement('div');
                    modal.id = 'infographicModal';
                    modal.style.position = 'fixed';
                    modal.style.top = '0';
                    modal.style.left = '0';
                    modal.style.width = '100%';
                    modal.style.height = '100%';
                    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    modal.style.display = 'flex';
                    modal.style.justifyContent = 'center';
                    modal.style.alignItems = 'center';
                    modal.style.zIndex = '10000';
                    modal.style.overflow = 'auto';
                    modal.style.padding = '20px';
                    
                    modal.innerHTML = `
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 20px; width: 95%; max-width: 1200px; height: 90vh; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin: auto; display: flex; flex-direction: column;" id="infographicModalContent">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; border-bottom: 1px solid #e0e0e0;">
                                <div>
                                    <h2 style="margin: 0; color: #2c3e50; font-size: 1.5em;">‚ú® AI Visual Generator</h2>
                                    <p style="margin: 5px 0 0; color: #7f8c8d; font-size: 0.9em;">Transform your notes into stunning visual infographics and comics</p>
                                </div>
                                <button id="closeInfographicModal" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.4em; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(238, 90, 36, 0.4); display: flex; align-items: center; justify-content: center; font-weight: bold;">&times;</button>
                            </div>
                            <div style="flex: 1; padding: 0; position: relative;">
                                <iframe 
                                    src="https://359690-5ecff51ef83547c495c1425ab7945e83-4-v4.app.mgx.dev" 
                                    style="width: 100%; height: 100%; border: none; border-radius: 0 0 20px 20px;"
                                    title="AI Visual Generator"
                                    allowfullscreen>
                                </iframe>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Add event listeners
                    document.getElementById('closeInfographicModal').addEventListener('click', function() {
                        document.body.removeChild(modal);
                    });
                    
                    // Close modal when clicking outside
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            document.body.removeChild(modal);
                        }
                    });
                    
                    // Add keyboard support (ESC key to close)
                    document.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape' && document.getElementById('infographicModal')) {
                            document.body.removeChild(modal);
                        }
                    });
                }



                                // File upload functionality for notes is handled by the sidebar button
                
                document.getElementById('noteFileInput').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Check file type
                    const allowedTypes = ['text/plain', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                    if (!allowedTypes.includes(file.type)) {
                        alert('Please upload a valid text file (txt, doc, docx)');
                        return;
                    }
                    
                    // Check file size (limit to 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File size exceeds 5MB limit');
                        return;
                    }
                    
                    // Create a FileReader to read the file content
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const content = e.target.result;
                        
                        // Create note object
                        const note = {
                            id: Date.now(),
                            fileName: file.name,
                            content: content,
                            uploadedAt: new Date().toISOString(),
                            uploader: "Darwin Danish Anak Nora" // In a real app, this would come from user data
                        };
                        
                        // Save note to localStorage
                        saveNote(note);
                        
                        // Add points for uploading a note
                        if (typeof addSharePoints === 'function') {
                            addSharePoints();
                        } else {
                            addNotePoints();
                        }
                        
                        // Show success message
                        alert('Note uploaded successfully! You earned 15 points for sharing content!');
                        
                        // Display the note in community section
                        displayCommunityNotes();
                    };
                    
                    reader.onerror = function() {
                        alert('Error reading file');
                    };
                    
                    // Read file based on type
                    if (file.type === 'text/plain') {
                        reader.readAsText(file);
                    } else {
                        // For doc/docx files, we'll just show a success message
                        // In a real implementation, you might want to use a library like mammoth.js to read docx content
                        const note = {
                            id: Date.now(),
                            fileName: file.name,
                            content: "Note content (file type not supported for preview)",
                            uploadedAt: new Date().toISOString(),
                            uploader: "Darwin Danish Anak Nora"
                        };
                        
                        // Save note to localStorage
                        saveNote(note);
                        
                        if (typeof addSharePoints === 'function') {
                            addSharePoints();
                        } else {
                            addNotePoints();
                        }
                        alert('Note uploaded successfully! You earned 15 points for sharing content!');
                        
                        // Display the note in community section
                        displayCommunityNotes();
                    }
                });
                
                // Function to save note to localStorage
                function saveNote(note) {
                    let notes = JSON.parse(localStorage.getItem('communityNotes')) || [];
                    notes.push(note);
                    localStorage.setItem('communityNotes', JSON.stringify(notes));
                }
                
                // Function to display community notes
                function displayCommunityNotes() {
                    const container = document.getElementById('communityNotesContainer');
                    const notes = JSON.parse(localStorage.getItem('communityNotes')) || [];
                    
                    if (notes.length === 0) {
                        container.innerHTML = '<div style="color: #7f8c8d; text-align: center; padding: 20px; grid-column: 1 / -1;">No community notes yet. Be the first to upload!</div>';
                        return;
                    }
                    
                    container.innerHTML = '';
                    
                    notes.forEach(note => {
                        const noteElement = document.createElement('div');
                        noteElement.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)';
                        noteElement.style.borderRadius = '12px';
                        noteElement.style.padding = '20px';
                        noteElement.style.boxShadow = '0 4px 12px rgba(0,0,0,0.05)';
                        noteElement.style.border = '1px solid #e0e0e0';
                        
                        noteElement.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div>
                                    <h4 style="margin: 0 0 8px 0; color: #2c3e50;">${note.fileName}</h4>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">
                                        Uploaded by: <b>${note.uploader}</b>
                                    </div>
                                </div>
                                <div style="font-size: 0.8em; color: #95a5a6;">
                                    ${new Date(note.uploadedAt).toLocaleDateString()}
                                </div>
                            </div>
                            <div style="margin-bottom: 15px; color: #34495e; font-size: 0.95em; line-height: 1.5;">
                                ${note.content.substring(0, 150)}${note.content.length > 150 ? '...' : ''}
                            </div>
                            <div style="display: flex; justify-content: flex-end;">
                                <button onclick="viewNote(${note.id})" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none; border-radius: 6px; padding: 8px 16px; font-size: 0.9em; cursor: pointer;">
                                    View Note
                                </button>
                            </div>
                        `;
                        
                        container.appendChild(noteElement);
                    });
                }
                
                // Function to view a note
                window.viewNote = function(noteId) {
                    const notes = JSON.parse(localStorage.getItem('communityNotes')) || [];
                    const note = notes.find(n => n.id === noteId);
                    
                    if (!note) {
                        alert('Note not found');
                        return;
                    }
                    
                    // Create modal for note viewing
                    const modal = document.createElement('div');
                    modal.style.position = 'fixed';
                    modal.style.top = '0';
                    modal.style.left = '0';
                    modal.style.width = '100%';
                    modal.style.height = '100%';
                    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    modal.style.display = 'flex';
                    modal.style.justifyContent = 'center';
                    modal.style.alignItems = 'center';
                    modal.style.zIndex = '10000';
                    modal.style.padding = '20px';
                    
                    modal.innerHTML = `
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 20px; padding: 30px; width: 90%; max-width: 800px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin: auto;" id="viewNoteModalContent">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="margin: 0; color: #2c3e50;">${note.fileName}</h2>
                                <button id="closeViewNoteModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                            </div>
                            <div style="margin-bottom: 15px; color: #7f8c8d;">
                                Uploaded by: <b>${note.uploader}</b> on ${new Date(note.uploadedAt).toLocaleDateString()}
                            </div>
                            <div style="background: white; border-radius: 10px; padding: 20px; border: 1px solid #e0e0e0; max-height: 500px; overflow-y: auto; white-space: pre-wrap; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6;">
                                ${note.content}
                            </div>
                            <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                                <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: #95a5a6; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-weight: 600; cursor: pointer;">Close</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Add event listener for close button
                    const closeBtn = modal.querySelector('#closeViewNoteModal');
                    if (closeBtn) {
                        closeBtn.addEventListener('click', function() {
                            document.body.removeChild(modal);
                        });
                    }
                    
                    // Also close when clicking outside the modal content
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            document.body.removeChild(modal);
                        }
                    });
                };
                
                // Display community notes when page loads
                displayCommunityNotes();
                
                // Add event listeners for sidebar buttons
                document.getElementById('sidebarTransformBtn').addEventListener('click', function() {
                    // Trigger the transform notes functionality directly
                    transformNotesToInfographic();
                });
                
                document.getElementById('sidebarUploadBtn').addEventListener('click', function() {
                    // Trigger the upload notes functionality directly
                    document.getElementById('noteFileInput').click();
                });
                
                // Rewards functionality
                document.querySelector('.quick-action-btn:nth-child(3)').addEventListener('click', function() {
                    showRewardsModal();
                });
                
                // Make showRewardsModal a global function
                window.showRewardsModal = function(event) {
                    console.log('showRewardsModal called', event);
                    if (event) {
                        event.preventDefault();
                        
                        // Remove active class from all nav buttons
                        document.querySelectorAll('.vertical-nav-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        // Add active class to rewards button
                        event.target.closest('.vertical-nav-btn').classList.add('active');
                    }
                    // Create rewards modal
                    const modal = document.createElement('div');
                    modal.style.position = 'fixed';
                    modal.style.top = '0';
                    modal.style.left = '0';
                    modal.style.width = '100%';
                    modal.style.height = '100%';
                    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    modal.style.display = 'flex';
                    modal.style.justifyContent = 'center';
                    modal.style.alignItems = 'center';
                    modal.style.zIndex = '10000';
                    modal.style.padding = '20px';
                    
                    // Define rewards
                    const rewards = [
                        {
                            id: 1,
                            name: "Free Book Voucher",
                            description: "Redeem at any bookstore for a free book of your choice",
                            points: 25,
                            icon: "üìö"
                        },
                        {
                            id: 2,
                            name: "STEM Stationery Set",
                            description: "Complete set of pens, pencils, and notebooks",
                            points: 50,
                            icon: "‚úèÔ∏è"
                        },
                        {
                            id: 3,
                            name: "STEM Sticker Pack",
                            description: "Exclusive STEM-themed stickers for your devices",
                            points: 15,
                            icon: "ü§©"
                        },
                        {
                            id: 4,
                            name: "Premium STEM T-Shirt",
                            description: "High-quality STEM-themed t-shirt",
                            points: 75,
                            icon: "üëï"
                        }
                    ];
                    
                    // Get current points from localStorage to ensure accuracy
                    const currentPoints = parseInt(localStorage.getItem('studentPoints')) || 0;
                    
                    // Generate rewards HTML
                    let rewardsHTML = '';
                    rewards.forEach(reward => {
                        const canRedeem = currentPoints >= reward.points;
                        rewardsHTML += `
                            <div style="background: ${canRedeem ? 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)' : '#f1f2f6'}; border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid #e0e0e0; position: relative;">
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="font-size: 2em; margin-right: 15px;">${reward.icon}</div>
                                    <div>
                                        <h3 style="margin: 0 0 5px 0; color: #2c3e50;">${reward.name}</h3>
                                        <div style="color: #7f8c8d; font-size: 0.9em;">${reward.description}</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-weight: bold; color: #e74c3c;">
                                        ${reward.points} points
                                    </div>
                                    ${canRedeem ?
                                        `<button onclick="redeemReward(${reward.id})" style="background: linear-gradient(135deg, #27ae60 0%, #219653 100%); color: white; border: none; border-radius: 6px; padding: 8px 16px; font-weight: 600; cursor: pointer;">
                                            Redeem Now
                                        </button>
                                        <div style="position: absolute; top: 10px; right: 10px; background: #27ae60; color: white; padding: 5px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">
                                            Congratulations! üéâ
                                        </div>` :
                                        `<button style="background: #95a5a6; color: white; border: none; border-radius: 6px; padding: 8px 16px; font-weight: 600; cursor: not-allowed;" disabled>
                                            Not Enough Points
                                        </button>`
                                    }
                                </div>
                            </div>
                        `;
                    });
                    
                    modal.innerHTML = `
                        <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 20px; padding: 30px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin: auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="margin: 0; color: #2c3e50;">üéÅ Rewards Center</h2>
                                <button id="closeRewardsModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                            </div>
                            <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); border-radius: 10px; color: white; text-align: center;">
                                <div style="font-size: 1.2em; font-weight: bold;">Your Points: <span style="font-size: 1.5em;">${currentPoints}</span></div>
                            </div>
                            <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                                ${rewardsHTML}
                            </div>
                            <div style="margin-top: 20px; text-align: center; color: #7f8c8d; font-size: 0.9em;">
                                Keep earning points by playing games and uploading notes!
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    
                    // Add event listener for close button
                    const rewardsCloseBtn = modal.querySelector('#closeRewardsModal');
                    if (rewardsCloseBtn) {
                        rewardsCloseBtn.addEventListener('click', function() {
                            document.body.removeChild(modal);
                        });
                    }
                    
                    // Also close when clicking outside the modal content
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            document.body.removeChild(modal);
                        }
                    });
                }
                
                // Function to redeem rewards
                window.redeemReward = function(rewardId) {
                    const rewards = [
                        {
                            id: 1,
                            name: "Free Book Voucher",
                            points: 25
                        },
                        {
                            id: 2,
                            name: "STEM Stationery Set",
                            points: 50
                        },
                        {
                            id: 3,
                            name: "STEM Sticker Pack",
                            points: 15
                        },
                        {
                            id: 4,
                            name: "Premium STEM T-Shirt",
                            points: 75
                        }
                    ];
                    
                    const reward = rewards.find(r => r.id === rewardId);
                    
                    if (!reward) {
                        alert('Reward not found');
                        return;
                    }
                    
                    if (points >= reward.points) {
                        // In a real implementation, you would connect to a backend to process the reward
                        alert(`Congratulations! You've redeemed: ${reward.name}\n\nPlease visit the rewards counter with this confirmation to claim your reward.`);
                    } else {
                        alert('You do not have enough points to redeem this reward.');
                    }
                };

            });
        </script>
    </body>
</html>
